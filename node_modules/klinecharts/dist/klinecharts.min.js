/**
 * @license
 * KLineChart v9.0.0-alpha7
 * Copyright (c) 2019 lihu.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts={})}(this,(function(t){"use strict";const e=new class{constructor(){this._baseId=1}next(t){const e=(new Date).getTime();return e===this._prevIdTimestamp?++this._baseId:this._baseId=1,this._prevIdTimestamp=e,`${null!=t?t:""}${e}_${this._baseId}`}};function i(t){return e.next(t)}function n(t,e){var i;const n=document.createElement(t),s=null!=e?e:{};for(const t in s)n.style[t]=null!==(i=s[t])&&void 0!==i?i:"";return n}let s;function o(t){var e,i,n;return null!==(n=null===(i=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===i?void 0:i.devicePixelRatio)&&void 0!==n?n:2}function r(t,e,i){return`${null!=e?e:"normal"} ${null!=t?t:12}px ${null!=i?i:"Helvetica Neue"}`}function a(t,e,i,n){if(void 0===s){const t=document.createElement("canvas"),e=o(t);s=t.getContext("2d"),s.scale(e,e)}return s.font=r(e,i,n),Math.round(s.measureText(t).width)}function l(t,e){if(d(t)||d(e))for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const n=t[i],s=e[i];d(s)&&d(n)&&!h(s)&&!h(n)?l(n,s):v(e[i])&&(t[i]=e[i])}}function c(t){if(!d(t)||!h(t))return t;let e;e=h(t)?[]:{};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const n=t[i];d(n)?e[i]=c(n):e[i]=n}return e}function h(t){return"[object Array]"===Object.prototype.toString.call(t)}function u(t){return"function"==typeof t}function d(t){return"object"==typeof t}function g(t){return"number"==typeof t&&!isNaN(t)}function v(t){return null!=t}function m(t){return"string"==typeof t}const p=/\\(\\)?/g,_=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g");function x(t,e,i){if(v(t)){const n=[];e.replace(_,((t,...e)=>{let i=t;return v(e[1])?i=e[2].replace(p,"$1"):v(e[0])&&(i=e[0].trim()),n.push(i),""}));let s=t,o=0;const r=n.length;for(;v(s)&&o<r;)s=null==s?void 0:s[n[o++]];return v(s)?s:null!=i?i:"--"}return null!=i?i:"--"}function f(t,e,i){const n=t.format(new Date(e)).split(", "),s=n[0].split("/"),o=n[1].split(":"),r={YYYY:s[2],MM:s[0],DD:s[1],HH:"24"===o[0]?"00":o[0],mm:o[1],ss:o[2]};return i.replace(/YYYY|MM|DD|HH|mm|ss/g,(t=>r[t]))}function y(t,e){const i=+t;return g(i)?i.toFixed(null!=e?e:2):`${i}`}function S(t){const e=+t;return g(e)?t>1e9?+(e/1e9).toFixed(3)+"B":t>1e6?+(e/1e6).toFixed(3)+"M":t>1e3?+(e/1e3).toFixed(3)+"K":`${t}`:"--"}function C(t,e,i){let n=0,s=0;for(s=t.length-1;n!==s;){const o=Math.floor((s+n)/2),r=s-n,a=t[o][e];if(i===t[n][e])return n;if(i===t[s][e])return s;if(i===a)return o;if(i>a?n=o:s=o,r<=2)break}return n}function b(t,e){null==e&&(e=10),e=Math.min(Math.max(0,e),20);return+(+t).toFixed(e)}function w(t,e,i){const n=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER];return t.forEach((t=>{var s,o;n[0]=Math.max(null!==(s=t[e])&&void 0!==s?s:t,n[0]),n[1]=Math.min(null!==(o=t[i])&&void 0!==o?o:t,n[1])})),n}function E(t){return Math.log(t)/Math.log(10)}function I(t){return Math.pow(10,t)}const T=1,D=50;class M{constructor(t){this._dateTimeFormat=this._buildDateTimeFormat(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalBarSpace=0,this._barSpace=6,this._offsetRightDistance=50,this._startScrollOffsetRightBarCount=0,this._minVisibleBarCount={left:2,right:2},this._visibleRange={from:0,to:0},this._chartStore=t,this._gapBarSpace=this._calcGapBarSpace(),this._offsetRightBarCount=this._offsetRightDistance/this._barSpace}_calcGapBarSpace(){const t=Math.floor(.82*this._barSpace),e=Math.floor(this._barSpace),i=Math.min(t,e-1);return Math.max(1,i)}adjustVisibleRange(){var t;const e=this._chartStore.getDataList(),i=e.length,n=this._totalBarSpace/this._barSpace,s=n-Math.min(this._minVisibleBarCount.left,i);this._offsetRightBarCount>s&&(this._offsetRightBarCount=s);const o=-i+Math.min(this._minVisibleBarCount.right,i);this._offsetRightBarCount<o&&(this._offsetRightBarCount=o);let r=Math.round(this._offsetRightBarCount+i+.5);r>i&&(r=i);let a=Math.round(r-n)-1;if(a<0&&(a=0),this._visibleRange={from:a,to:r},this._chartStore.getActionStore().execute("onVisibleDataChange",{from:a,to:r}),this._chartStore.adjustVisibleDataList(),0===a&&this._more&&!this._loading&&null!==this._loadMoreCallback){this._loading=!0;const i=e[0];this._loadMoreCallback(null!==(t=null==i?void 0:i.timestamp)&&void 0!==t?t:null)}}setMore(t){return this._more=t,this}setLoading(t){return this._loading=t,this}getDateTimeFormat(){return this._dateTimeFormat}_buildDateTimeFormat(t){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};void 0!==t&&(e.timeZone=t);let i=null;try{i=new Intl.DateTimeFormat("en",e)}catch(t){}return i}setTimezone(t){const e=this._buildDateTimeFormat(t);null!==e&&(this._dateTimeFormat=e)}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:this._gapBarSpace/2}}setBarSpace(t,e){t<T||t>D||this._barSpace===t||(this._barSpace=t,this._gapBarSpace=this._calcGapBarSpace(),null==e||e(),this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0))}setTotalBarSpace(t){return this._totalBarSpace!==t&&(this._totalBarSpace=t,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0)),this}setOffsetRightDistance(t,e){return this._offsetRightDistance=t,this._offsetRightBarCount=t/this._barSpace,null!=e&&e&&(this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)),this}resetOffsetRightDistance(){this.setOffsetRightDistance(this._offsetRightDistance)}getOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightBarCount(){return this._offsetRightBarCount}setOffsetRightBarCount(t){return this._offsetRightBarCount=t,this}setLeftMinVisibleBarCount(t){return this._minVisibleBarCount.left=t,this}setRightMinVisibleBarCount(t){return this._minVisibleBarCount.right=t,this}getVisibleRange(){return this._visibleRange}startScroll(){this._startScrollOffsetRightBarCount=this._offsetRightBarCount}scroll(t){if(!this._scrollEnabled)return;const e=t/this._barSpace;this._chartStore.getActionStore().execute("onScroll"),this._offsetRightBarCount=this._startScrollOffsetRightBarCount-e,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)}getDataByDataIndex(t){var e;return null!==(e=this._chartStore.getDataList()[t])&&void 0!==e?e:null}coordinateToFloatIndex(t){const e=this._chartStore.getDataList().length,i=(this._totalBarSpace-t)/this._barSpace,n=e+this._offsetRightBarCount-i;return Math.round(1e6*n)/1e6}dataIndexToTimestamp(t){var e;const i=this.getDataByDataIndex(t);return null!==(e=null==i?void 0:i.timestamp)&&void 0!==e?e:null}timestampToDataIndex(t){const e=this._chartStore.getDataList();return 0===e.length?0:C(e,"timestamp",t)}dataIndexToCoordinate(t){const e=this._chartStore.getDataList().length+this._offsetRightBarCount-t;return this._totalBarSpace-(e-.5)*this._barSpace}coordinateToDataIndex(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}zoom(t,e){if(!this._zoomEnabled)return;if(void 0===(null==e?void 0:e.x)){const t=this._chartStore.getCrosshairStore().get();e={x:void 0!==(null==t?void 0:t.x)?t.x:this._totalBarSpace/2}}this._chartStore.getActionStore().execute("onZoom");const i=this.coordinateToFloatIndex(e.x),n=this._barSpace+t*(this._barSpace/10);this.setBarSpace(n,(()=>{this._offsetRightBarCount+=i-this.coordinateToFloatIndex(null==e?void 0:e.x)}))}setZoomEnabled(t){return this._zoomEnabled=t,this}getZoomEnabled(){return this._zoomEnabled}setScrollEnabled(t){return this._scrollEnabled=t,this}getScrollEnabled(){return this._scrollEnabled}setLoadMoreCallback(t){return this._loadMoreCallback=t,this}clear(){this._more=!0,this._loading=!0,this._visibleRange={from:0,to:0}}}function P(t,e,i,n,s){const o=e.result,r=e.figures,a=e.styles,l=x(a,"circles",n.circles),c=l.length,h=x(a,"bars",n.bars),u=h.length,d=x(a,"lines",n.lines),g=d.length;let m,p,_,f=0,y=0,S=0,C=0;r.forEach((r=>{var a,x,b,w;switch(r.type){case"circle":m=l[f%c],p=m.style,_=m.noChangeColor,C=f,f++;break;case"bar":m=h[y%u],p=m.style,_=m.noChangeColor,C=y,y++;break;case"line":m=d[S%g],p=m.style,_=m.color,C=S,S++}if(v(m)){const l={prev:{kLineData:t[i-1],indicatorData:o[i-1]},current:{kLineData:t[i],indicatorData:o[i]},next:{kLineData:t[i+1],indicatorData:o[i+1]}},c=null!==(x=null===(a=r.styles)||void 0===a?void 0:a.call(r,l,e,n))&&void 0!==x?x:{style:p,color:_};s(r,{style:null!==(b=c.style)&&void 0!==b?b:p,color:null!==(w=c.color)&&void 0!==w?w:_},m,C)}}))}class k{constructor(t){this.result=[],this._precisionFlag=!1;const{name:e,shortName:i,series:n,calcParams:s,figures:o,precision:r,shouldOhlc:a,shouldFormatBigNumber:l,minValue:c,maxValue:h,styles:u,extendData:d,regenerateFigures:g,createTooltipDataSource:v,draw:m}=t;this.name=e,this.shortName=null!=i?i:e,this.series=null!=n?n:"normal",this.precision=null!=r?r:4,this.calcParams=null!=s?s:[],this.figures=null!=o?o:[],this.shouldOhlc=null!=a&&a,this.shouldFormatBigNumber=null!=l&&l,this.minValue=null!=c?c:null,this.maxValue=null!=h?h:null,this.styles=null!=u?u:null,this.extendData=d,this.regenerateFigures=null!=g?g:null,this.createTooltipDataSource=null!=v?v:null,this.draw=null!=m?m:null}setShortName(t){return this.shortName!==t&&(this.shortName=t,!0)}setSeries(t){return this.series!==t&&(this.series=t,!0)}setPrecision(t,e){const i=null!=e&&e,n=Math.floor(t);return!(!(n!==this.precision&&t>=0)||i&&(!i||this._precisionFlag))&&(this.precision=n,i||(this._precisionFlag=!0),!0)}setCalcParams(t){var e,i;return this.calcParams=t,this.figures=null!==(i=null===(e=this.regenerateFigures)||void 0===e?void 0:e.call(this,t))&&void 0!==i?i:this.figures,!0}setShouldOhlc(t){return this.shouldOhlc!==t&&(this.shouldOhlc=t,!0)}setShouldFormatBigNumber(t){return this.shouldFormatBigNumber!==t&&(this.shouldFormatBigNumber=t,!0)}setStyles(t){return this.styles!==t&&(this.styles=t,!0)}setExtendData(t){return this.extendData!==t&&(this.extendData=t,!0)}setFigures(t){return this.figures!==t&&(this.figures=t,!0)}setMinValue(t){return this.minValue!==t&&(this.minValue=t,!0)}setMaxValue(t){return this.maxValue!==t&&(this.maxValue=t,!0)}setRegenerateFigures(t){return this.regenerateFigures!==t&&(this.regenerateFigures=t,!0)}setCreateTooltipDataSource(t){return this.createTooltipDataSource!==t&&(this.createTooltipDataSource=t,!0)}setDraw(t){return this.draw!==t&&(this.draw=t,!0)}async calcIndicator(t){try{const e=await this.calc(t,this);return this.result=e,!0}catch(t){return!1}}static extend(t){return class extends k{constructor(){super(t)}calc(e,i){return t.calc(e,i)}}}}const A={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>{const i=e+1;return{key:`rsi${i}`,title:`RSI${i}: `,type:"line"}})),calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[],o=[];return t.map(((e,r)=>{var a;const l={},c=(null!==(a=t[r-1])&&void 0!==a?a:e).close,h=e.close-c;return i.forEach(((e,i)=>{var a,c,u;if(h>0?s[i]=(null!==(a=s[i])&&void 0!==a?a:0)+h:o[i]=(null!==(c=o[i])&&void 0!==c?c:0)+Math.abs(h),r>=e-1){0!==o[i]?l[n[i].key]=100-100/(1+s[i]/o[i]):l[n[i].key]=0;const a=t[r-(e-1)],c=null!==(u=t[r-e])&&void 0!==u?u:a,h=a.close-c.close;h>0?s[i]-=h:o[i]-=Math.abs(h)}})),l}))}},F={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(t,e,i)=>{const n=t.current.kLineData;let s;return s=n.close>n.open?x(e.styles,"bars[0].upColor",i.bars[0].upColor):n.close<n.open?x(e.styles,"bars[0].downColor",i.bars[0].downColor):x(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{color:s}}}],regenerateFigures:t=>{const e=t.map(((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"})));return e.push({key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(t,e,i)=>{const n=t.current.kLineData;let s;return s=n.close>n.open?x(e.styles,"bars[0].upColor",i.bars[0].upColor):n.close<n.open?x(e.styles,"bars[0].downColor",i.bars[0].downColor):x(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{color:s}}}),e},calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[];return t.map(((e,o)=>{var r;const a=null!==(r=e.volume)&&void 0!==r?r:0,l={volume:a};return i.forEach(((e,i)=>{var r,c;s[i]=(null!==(r=s[i])&&void 0!==r?r:0)+a,o>=e-1&&(l[n[i].key]=s[i]/e,s[i]-=null!==(c=t[o-(e-1)].volume)&&void 0!==c?c:0)})),l}))}},L={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`wr${e+1}`,title:`WR${e+1}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e;return t.map(((e,s)=>{const o={},r=e.close;return i.forEach(((e,i)=>{const a=e-1;if(s>=a){const e=w(t.slice(s-a,s+1),"high","low"),l=e[0],c=l-e[1];o[n[i].key]=0===c?0:(r-l)/c*100}})),o}))}},B={},R=[{name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:t=>{let e=0,i=0;return t.map((t=>{var n,s;const o={},r=null!==(n=null==t?void 0:t.turnover)&&void 0!==n?n:0,a=null!==(s=null==t?void 0:t.volume)&&void 0!==s?s:0;return e+=r,i+=a,0!==i&&(o.avp=e/i),o}))}},{name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:(t,e,i)=>{var n,s,o,r;const{prev:a,current:l}=t,c=null!==(s=null===(n=a.indicatorData)||void 0===n?void 0:n.ao)&&void 0!==s?s:Number.MIN_SAFE_INTEGER,h=null!==(r=null===(o=l.indicatorData)||void 0===o?void 0:o.ao)&&void 0!==r?r:Number.MIN_SAFE_INTEGER;let u;u=h>c?x(e.styles,"bars[0].upColor",i.bars[0].upColor):x(e.styles,"bars[0].downColor",i.bars[0].downColor);return{color:u,style:h>c?"stroke":"fill"}}}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(i[0],i[1]);let s=0,o=0,r=0,a=0;return t.map(((e,l)=>{const c={},h=(e.low+e.high)/2;if(s+=h,o+=h,l>=i[0]-1){r=s/i[0];const e=t[l-(i[0]-1)];s-=(e.low+e.high)/2}if(l>=i[1]-1){a=o/i[1];const e=t[l-(i[1]-1)];o-=(e.low+e.high)/2}return l>=n-1&&(c.ao=r-a),c}))}},{name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`bias${e+1}`,title:`BIAS${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[];return t.map(((e,o)=>{const r={},a=e.close;return i.forEach(((e,l)=>{var c;if(s[l]=(null!==(c=s[l])&&void 0!==c?c:0)+a,o>=e-1){const c=s[l]/i[l];r[n[l].key]=(a-c)/c*100,s[l]-=t[o-(e-1)].close}})),r}))}},{name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=i[0]-1;let s=0;return t.map(((e,o)=>{const r=e.close,a={};if(s+=r,o>=n){a.mid=s/i[0];const e=function(t,e){const i=t.length;let n=0;return t.forEach((t=>{const i=t.close-e;n+=i*i})),n=Math.abs(n),Math.sqrt(n/i)}(t.slice(o-n,o+1),a.mid);a.up=a.mid+i[1]*e,a.dn=a.mid-i[1]*e,s-=t[o-n].close}return a}))}},{name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0,o=0,r=0;return t.map(((e,a)=>{var l,c;const h={},u=e.high,d=e.low,g=e.open,v=(null!==(l=t[a-1])&&void 0!==l?l:e).close;if(o+=u-g,r+=g-d,n+=u-v,s+=v-d,a>=i[0]-1){h.ar=0!==r?o/r*100:0,h.br=0!==s?n/s*100:0;const e=t[a-(i[0]-1)],l=e.high,u=e.low,d=e.open,g=(null!==(c=t[a-i[0]])&&void 0!==c?c:t[a-(i[0]-1)]).close;n-=l-g,s-=g-u,o-=l-d,r-=d-u}return h}))}},{name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(...i),s=[],o=[];return t.map(((e,r)=>{const a={},l=e.close;if(i.forEach(((e,i)=>{var n;s[i]=(null!==(n=s[i])&&void 0!==n?n:0)+l,r>=e-1&&(o[i]=s[i]/e,s[i]-=t[r-(e-1)].close)})),r>=n-1){let t=0;o.forEach((e=>{t+=e})),a.bbi=t/4}return a}))}},{name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=i[0]-1;let s=0;const o=[];return t.map(((e,r)=>{const a={},l=(e.high+e.low+e.close)/3;if(s+=l,o.push(l),r>=n){const e=s/i[0],c=o.slice(r-n,r+1);let h=0;c.forEach((t=>{h+=Math.abs(t-e)}));const u=h/i[0];a.cci=0!==u?(l-e)/u/.015:0;const d=(t[r-n].high+t[r-n].low+t[r-n].close)/3;s-=d}return a}))}},{name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.ceil(i[1]/2.5+1),s=Math.ceil(i[2]/2.5+1),o=Math.ceil(i[3]/2.5+1),r=Math.ceil(i[4]/2.5+1);let a=0;const l=[];let c=0;const h=[];let u=0;const d=[];let g=0;const v=[],m=[];return t.forEach(((e,p)=>{var _,x,f,y,S;const C={},b=null!==(_=t[p-1])&&void 0!==_?_:e,w=(b.high+b.close+b.low+b.open)/4,E=Math.max(0,e.high-w),I=Math.max(0,w-e.low);p>=i[0]-1&&(C.cr=0!==I?E/I*100:0,a+=C.cr,c+=C.cr,u+=C.cr,g+=C.cr,p>=i[0]+i[1]-2&&(l.push(a/i[1]),p>=i[0]+i[1]+n-3&&(C.ma1=l[l.length-1-n]),a-=null!==(x=m[p-(i[1]-1)].cr)&&void 0!==x?x:0),p>=i[0]+i[2]-2&&(h.push(c/i[2]),p>=i[0]+i[2]+s-3&&(C.ma2=h[h.length-1-s]),c-=null!==(f=m[p-(i[2]-1)].cr)&&void 0!==f?f:0),p>=i[0]+i[3]-2&&(d.push(u/i[3]),p>=i[0]+i[3]+o-3&&(C.ma3=d[d.length-1-o]),u-=null!==(y=m[p-(i[3]-1)].cr)&&void 0!==y?y:0),p>=i[0]+i[4]-2&&(v.push(g/i[4]),p>=i[0]+i[4]+r-3&&(C.ma4=v[v.length-1-r]),g-=null!==(S=m[p-(i[4]-1)].cr)&&void 0!==S?S:0)),m.push(C)})),m}},{name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(i[0],i[1]);let s=0,o=0,r=0;const a=[];return t.forEach(((e,l)=>{var c;const h={},u=e.close;s+=u,o+=u;let d=0,g=0;if(l>=i[0]-1&&(d=s/i[0],s-=t[l-(i[0]-1)].close),l>=i[1]-1&&(g=o/i[1],o-=t[l-(i[1]-1)].close),l>=n-1){const t=d-g;h.dma=t,r+=t,l>=n+i[2]-2&&(h.ama=r/i[2],r-=null!==(c=a[l-(i[2]-1)].dma)&&void 0!==c?c:0)}a.push(h)})),a}},{name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0,o=0,r=0,a=0,l=0,c=0,h=0;const u=[];return t.forEach(((e,d)=>{var g,v;const m={},p=null!==(g=t[d-1])&&void 0!==g?g:e,_=p.close,x=e.high,f=e.low,y=x-f,S=Math.abs(x-_),C=Math.abs(_-f),b=x-p.high,w=p.low-f,E=Math.max(Math.max(y,S),C),I=b>0&&b>w?b:0,T=w>0&&w>b?w:0;if(n+=E,s+=I,o+=T,d>=i[0]-1){d>i[0]-1?(r=r-r/i[0]+E,a=a-a/i[0]+I,l=l-l/i[0]+T):(r=n,a=s,l=o);let t=0,e=0;0!==r&&(t=100*a/r,e=100*l/r),m.pdi=t,m.mdi=e;let g=0;e+t!==0&&(g=Math.abs(e-t)/(e+t)*100),c+=g,d>=2*i[0]-2&&(h=d>2*i[0]-2?(h*(i[0]-1)+g)/i[0]:c/i[0],m.adx=h,d>=2*i[0]+i[1]-3&&(m.adxr=((null!==(v=u[d-(i[1]-1)].adx)&&void 0!==v?v:0)+h)/2))}u.push(m)})),u}},{name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;const o=[],r=[];return t.forEach(((e,a)=>{var l,c,h;const u={},d=null!==(l=t[a-1])&&void 0!==l?l:e,g=e.high,v=e.low,m=null!==(c=e.turnover)&&void 0!==c?c:0,p=(g+v)/2,_=(d.high+d.low)/2;let x=0;0!==m&&(x=(p-_)*(g-v)/m),o.push(x),n+=x,a>=i[0]-1&&(u.emv=n,n-=o[a-(i[0]-1)],s+=u.emv,a>=i[0]+i[1]-2&&(u.maEmv=s/i[1],s-=null!==(h=r[a-(i[1]-1)].emv)&&void 0!==h?h:0)),r.push(u)})),r}},{name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`ema${e+1}`,title:`EMA${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e;let s=0;const o=[];return t.map(((t,e)=>{const r={},a=t.close;return s+=a,i.forEach(((t,i)=>{e>=t-1&&(o[i]=e>t-1?(2*a+(t-1)*o[i])/(t+1):s/t,r[n[i].key]=o[i])})),r}))}},{name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0;const s=[];return t.forEach(((e,o)=>{var r;const a={};if(o>=i[0]){const l=e.close,c=t[o-i[0]].close;a.mtm=l-c,n+=a.mtm,o>=i[0]+i[1]-1&&(a.maMtm=n/i[1],n-=null!==(r=s[o-(i[1]-1)].mtm)&&void 0!==r?r:0)}s.push(a)})),s}},{name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[];return t.map(((e,o)=>{const r={},a=e.close;return i.forEach(((e,i)=>{var l;s[i]=(null!==(l=s[i])&&void 0!==l?l:0)+a,o>=e-1&&(r[n[i].key]=s[i]/e,s[i]-=t[o-(e-1)].close)})),r}))}},{name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:(t,e,i)=>{var n,s,o,r;const{prev:a,current:l}=t,c=null!==(s=null===(n=a.indicatorData)||void 0===n?void 0:n.macd)&&void 0!==s?s:Number.MIN_SAFE_INTEGER,h=null!==(r=null===(o=l.indicatorData)||void 0===o?void 0:o.macd)&&void 0!==r?r:Number.MIN_SAFE_INTEGER;let u;u=h>0?x(e.styles,"bars[0].upColor",i.bars[0].upColor):h<0?x(e.styles,"bars[0].downColor",i.bars[0].downColor):x(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor);return{style:c<h?"stroke":"fill",color:u}}}],calc:(t,e)=>{const i=e.calcParams;let n,s,o=0,r=0,a=0,l=0;const c=Math.max(i[0],i[1]);return t.map(((t,e)=>{const h={},u=t.close;return o+=u,e>=i[0]-1&&(n=e>i[0]-1?(2*u+(i[0]-1)*n)/(i[0]+1):o/i[0]),e>=i[1]-1&&(s=e>i[1]-1?(2*u+(i[1]-1)*s)/(i[1]+1):o/i[1]),e>=c-1&&(r=n-s,h.dif=r,a+=r,e>=c+i[2]-2&&(l=e>c+i[2]-2?(2*r+l*(i[2]-1))/(i[2]+1):a/i[2],h.macd=2*(r-l),h.dea=l)),h}))}},{name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;const o=[];return t.forEach(((e,r)=>{var a,l,c,h;const u=null!==(a=t[r-1])&&void 0!==a?a:e;e.close<u.close?s-=null!==(l=e.volume)&&void 0!==l?l:0:e.close>u.close&&(s+=null!==(c=e.volume)&&void 0!==c?c:0);const d={obv:s};n+=s,r>=i[0]-1&&(d.maObv=n/i[0],n-=null!==(h=o[r-(i[0]-1)].obv)&&void 0!==h?h:0),o.push(d)})),o}},{name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:t=>{let e=0;return t.map(((i,n)=>{var s,o;const r={},a=i.close,l=null!==(s=i.volume)&&void 0!==s?s:1,c=(null!==(o=t[n-1])&&void 0!==o?o:i).close;let h=0;const u=c*l;return 0!==u&&(h=(a-c)/u),e+=h,r.pvt=e,r}))}},{name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;const o=[],r=[];return t.forEach(((e,a)=>{var l,c;const h={},u=(null!==(l=t[a-1])&&void 0!==l?l:e).close,d=e.close-u>0?1:0;o.push(d),n+=d,a>=i[0]-1&&(h.psy=n/i[0]*100,s+=h.psy,a>=i[0]+i[1]-2&&(h.maPsy=s/i[1],s-=null!==(c=r[a-(i[1]-1)].psy)&&void 0!==c?c:0),n-=o[a-(i[0]-1)]),r.push(h)})),r}},{name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=[];let s=0;return t.forEach(((e,o)=>{var r,a;const l={};if(o>=i[0]-1){const c=e.close,h=(null!==(r=t[o-i[0]])&&void 0!==r?r:t[o-(i[0]-1)]).close;l.roc=0!==h?(c-h)/h*100:0,s+=l.roc,o>=i[0]-1+i[1]-1&&(l.maRoc=s/i[1],s-=null!==(a=n[o-(i[1]-1)].roc)&&void 0!==a?a:0)}n.push(l)})),n}},A,{name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;return t.map(((t,e)=>{const o={},r=t.close;return n+=r,e>=i[0]-1&&(s=e>i[0]-1?(r*i[1]+s*(i[0]-i[1]+1))/(i[0]+1):n/i[0],o.sma=s),o}))}},{name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=[];return t.forEach(((e,s)=>{var o,r,a,l;const c={},h=e.close;if(s>=i[0]-1){const e=w(t.slice(s-(i[0]-1),s+1),"high","low"),u=e[0],d=e[1],g=u-d,v=(h-d)/(0===g?1:g)*100;c.k=((i[1]-1)*(null!==(r=null===(o=n[s-1])||void 0===o?void 0:o.k)&&void 0!==r?r:50)+v)/i[1],c.d=((i[2]-1)*(null!==(l=null===(a=n[s-1])||void 0===a?void 0:a.d)&&void 0!==l?l:50)+c.k)/i[2],c.j=3*c.k-2*c.d}n.push(c)})),n}},{name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:(t,e,i)=>{var n,s;const{current:o}=t,r=null!==(s=null===(n=o.indicatorData)||void 0===n?void 0:n.sar)&&void 0!==s?s:Number.MIN_SAFE_INTEGER,a=o.kLineData;return{color:r<((null==a?void 0:a.high)+(null==a?void 0:a.low))/2?x(e.styles,"circles[0].upColor",i.circles[0].upColor):x(e.styles,"circles[0].downColor",i.circles[0].downColor)}}}],calc:(t,e)=>{const i=e.calcParams,n=i[0]/100,s=i[1]/100,o=i[2]/100;let r=n,a=-100,l=!1,c=0;return t.map(((e,i)=>{const h=c,u=e.high,d=e.low;if(l){(-100===a||a<u)&&(a=u,r=Math.min(r+s,o)),c=h+r*(a-h);const g=Math.min(t[Math.max(1,i)-1].low,d);c>e.low?(c=a,r=n,a=-100,l=!l):c>g&&(c=g)}else{(-100===a||a>d)&&(a=d,r=Math.min(r+s,o)),c=h+r*(a-h);const n=Math.max(t[Math.max(1,i)-1].high,u);c<e.high?(c=a,r=0,a=-100,l=!l):c<n&&(c=n)}return{sar:c}}))}},{name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n,s,o,r=0,a=0,l=0,c=0;const h=[];return t.forEach(((t,e)=>{var u;const d={},g=t.close;if(r+=g,e>=i[0]-1&&(n=e>i[0]-1?(2*g+(i[0]-1)*n)/(i[0]+1):r/i[0],a+=n,e>=2*i[0]-2&&(s=e>2*i[0]-2?(2*n+(i[0]-1)*s)/(i[0]+1):a/i[0],l+=s,e>=3*i[0]-3))){let t,n=0;e>3*i[0]-3?(t=(2*s+(i[0]-1)*o)/(i[0]+1),n=(t-o)/o*100):t=l/i[0],o=t,d.trix=n,c+=n,e>=3*i[0]+i[1]-4&&(d.maTrix=c/i[1],c-=null!==(u=h[e-(i[1]-1)].trix)&&void 0!==u?u:0)}h.push(d)})),h}},F,{name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0,o=0,r=0;const a=[];return t.forEach(((e,l)=>{var c,h,u,d,g;const v={},m=e.close,p=(null!==(c=t[l-1])&&void 0!==c?c:e).close,_=null!==(h=e.volume)&&void 0!==h?h:0;if(m>p?n+=_:m<p?s+=_:o+=_,l>=i[0]-1){const e=o/2;v.vr=s+e===0?0:(n+e)/(s+e)*100,r+=v.vr,l>=i[0]+i[1]-2&&(v.maVr=r/i[1],r-=null!==(u=a[l-(i[1]-1)].vr)&&void 0!==u?u:0);const c=t[l-(i[0]-1)],h=null!==(d=t[l-i[0]])&&void 0!==d?d:c,m=c.close,p=null!==(g=c.volume)&&void 0!==g?g:0;m>h.close?n-=p:m<h.close?s-=p:o-=p}a.push(v)})),a}},L];function N(t){var e;return null!==(e=B[t])&&void 0!==e?e:null}R.forEach((t=>{B[t.name]=k.extend(t)}));class V{constructor(t){this._instances=new Map,this._chartStore=t}_overrideInstance(t,e){const{shortName:i,series:n,calcParams:s,precision:o,figures:r,minValue:a,maxValue:l,shouldOhlc:c,shouldFormatBigNumber:h,styles:u,extendData:d,regenerateFigures:g,createTooltipDataSource:v,draw:m,calc:p}=e;let _=!1;void 0!==i&&t.setShortName(i)&&(_=!0),void 0!==n&&t.setSeries(n)&&(_=!0);let x=!1;return void 0!==s&&t.setCalcParams(s)&&(_=!0,x=!0),void 0!==r&&t.setFigures(r)&&(_=!0,x=!0),void 0!==a&&t.setMinValue(a)&&(_=!0),void 0!==l&&t.setMinValue(l)&&(_=!0),void 0!==o&&t.setPrecision(o)&&(_=!0),void 0!==c&&t.setShouldOhlc(c)&&(_=!0),void 0!==h&&t.setShouldFormatBigNumber(h)&&(_=!0),void 0!==u&&t.setStyles(u)&&(_=!0),void 0!==d&&t.setExtendData(d)&&(_=!0,x=!0),void 0!==g&&t.setRegenerateFigures(g)&&(_=!0),void 0!==v&&t.setCreateTooltipDataSource(v)&&(_=!0),void 0!==m&&t.setDraw(m)&&(_=!0),void 0!==p&&(t.calc=p,x=!0),[_,x]}async addInstance(t,e,i){var n;const{name:s}=t;let o=this._instances.get(e);if(null!==(n=null==o?void 0:o.has(s))&&void 0!==n&&n)return await Promise.reject(new Error("Duplicate indicators."));void 0===o&&(o=new Map,this._instances.set(e,o));const r=new(N(s));return this._overrideInstance(r,t),i||o.clear(),o.set(s,r),await r.calcIndicator(this._chartStore.getDataList())}getInstances(t){var e;return null!==(e=this._instances.get(t))&&void 0!==e?e:new Map}removeInstance(t,e){let i=!1;if(this._instances.has(t)){const n=this._instances.get(t);void 0!==e?n.has(e)&&(n.delete(e),i=!0):(n.clear(),i=!0),0===n.size&&this._instances.delete(t)}return i}hasInstances(t){return this._instances.has(t)}async calcInstance(t,e){var i;const n=[];if(void 0!==t)if(void 0!==e){const s=this._instances.get(e);if(null!==(i=null==s?void 0:s.has(t))&&void 0!==i&&i){const e=null==s?void 0:s.get(t);n.push(e.calcIndicator(this._chartStore.getDataList()))}}else this._instances.forEach((e=>{if(e.has(t)){const i=null==e?void 0:e.get(t);n.push(i.calcIndicator(this._chartStore.getDataList()))}}));else this._instances.forEach((t=>{t.forEach((t=>{n.push(t.calcIndicator(this._chartStore.getDataList()))}))}));return await Promise.all(n)}getInstanceByPaneId(t,e){var i;if(void 0!==t){const n=this._instances.get(t);return void 0!==e?null!==(i=null==n?void 0:n.get(e))&&void 0!==i?i:null:null!=n?n:null}return this._instances}setSeriesPrecision(t){this._instances.forEach((e=>{e.forEach((e=>{"price"===e.series&&e.setPrecision(t.price,!0),"volume"===e.series&&e.setPrecision(t.volume,!0)}))}))}async override(t,e){const{name:i}=t;let n=new Map;null!==e?this._instances.has(e)&&n.set(e,this._instances.get(e)):n=this._instances;const s=[];return n.forEach((e=>{if(e.has(i)){const n=e.get(i);this._overrideInstance(n,t)[1]&&s.push(n.calcIndicator(this._chartStore.getDataList()))}})),await Promise.all(s)}}class O{constructor(t){this._crosshair={},this._chartStore=t}set(t,e){const i=this._chartStore.getDataList(),n=null!=t?t:{};let s,o;void 0!==n.x?(s=this._chartStore.getTimeScaleStore().coordinateToDataIndex(n.x),o=s<0?0:s>i.length-1?i.length-1:s):(s=i.length-1,o=s);const r=i[o],a=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(s),l=this._crosshair.x,c=this._crosshair.y,h=this._crosshair.paneId;return this._crosshair={...n,realX:a,kLineData:r,realDataIndex:s,dataIndex:o},l===n.x&&c===n.y&&h===n.paneId||(null!==r&&this._chartStore.getChart().crosshairChange(this._crosshair),null!=e&&e||this._chartStore.getChart().updatePane(1)),this}recalculate(t){this.set(this._crosshair,t)}get(){return this._crosshair}}class z{constructor(t){this.currentStep=1,this.points=[],this._prevPressedPoint=null,this._prevPressedPoints=[];const{mode:e,extendData:i,styles:n,name:s,totalStep:o,lock:r,needDefaultPointFigure:a,needDefaultXAxisFigure:l,needDefaultYAxisFigure:c,createPointFigures:h,createXAxisFigures:u,createYAxisFigures:d,performEventPressedMove:g,performEventMoveForDrawing:v,onDrawStart:m,onDrawing:p,onDrawEnd:_,onClick:x,onRightClick:f,onPressedMoveStart:y,onPressedMoving:S,onPressedMoveEnd:C,onMouseEnter:b,onMouseLeave:w,onRemoved:E,onSelected:I,onDeselected:T}=t;this.name=s,this.totalStep=void 0===o||o<2?1:o,this.lock=null!=r&&r,this.needDefaultPointFigure=null!=a&&a,this.needDefaultXAxisFigure=null!=l&&l,this.needDefaultYAxisFigure=null!=c&&c,this.mode=null!=e?e:"normal",this.extendData=i,this.styles=null!=n?n:null,this.createPointFigures=null!=h?h:null,this.createXAxisFigures=null!=u?u:null,this.createYAxisFigures=null!=d?d:null,this.performEventPressedMove=null!=g?g:null,this.performEventMoveForDrawing=null!=v?v:null,this.onDrawStart=null!=m?m:null,this.onDrawing=null!=p?p:null,this.onDrawEnd=null!=_?_:null,this.onClick=null!=x?x:null,this.onRightClick=null!=f?f:null,this.onPressedMoveStart=null!=y?y:null,this.onPressedMoving=null!=S?S:null,this.onPressedMoveEnd=null!=C?C:null,this.onMouseEnter=null!=b?b:null,this.onMouseLeave=null!=w?w:null,this.onRemoved=null!=E?E:null,this.onSelected=null!=I?I:null,this.onDeselected=null!=T?T:null}setId(t){return void 0===this.id&&(this.id=t,!0)}setGroupId(t){return void 0===this.groupId&&(this.groupId=t,!0)}setExtendData(t){return t!==this.extendData&&(this.extendData=t,!0)}setStyles(t){return t!==this.styles&&(this.styles=t,!0)}setPoints(t){if(t.length>0){let e;if(this.points=[...t],t.length>=this.totalStep-1?(this.currentStep=-1,e=this.totalStep-1):(this.currentStep=t.length+1,e=t.length),null!==this.performEventMoveForDrawing)for(let t=0;t<e;t++)this.performEventMoveForDrawing({currentStep:t+2,mode:this.mode,points:this.points,performPointIndex:t,performPoint:this.points[t]});return-1===this.currentStep&&null!==this.performEventPressedMove&&this.performEventPressedMove({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}),!0}return!1}setLock(t){return this.lock!==t&&(this.lock=t,!0)}setMode(t){return t!==this.mode&&(this.mode=t,!0)}setOnDrawStartCallback(t){return this.onDrawStart!==t&&(this.onDrawStart=t,!0)}setOnDrawingCallback(t){return this.onDrawing!==t&&(this.onDrawing=t,!0)}setOnDrawEndCallback(t){return this.onDrawEnd!==t&&(this.onDrawEnd=t,!0)}setOnClickCallback(t){return this.onClick!==t&&(this.onClick=t,!0)}setOnRightClickCallback(t){return this.onRightClick!==t&&(this.onRightClick=t,!0)}setOnPressedMoveStartCallback(t){return this.onPressedMoveStart!==t&&(this.onPressedMoveStart=t,!0)}setOnPressedMovingCallback(t){return this.onPressedMoving!==t&&(this.onPressedMoving=t,!0)}setOnPressedMoveEndCallback(t){return this.onPressedMoveEnd!==t&&(this.onPressedMoveEnd=t,!0)}setOnMouseEnterCallback(t){return this.onMouseEnter!==t&&(this.onMouseEnter=t,!0)}setOnMouseLeaveCallback(t){return this.onMouseLeave!==t&&(this.onMouseLeave=t,!0)}setOnRemovedCallback(t){return this.onRemoved!==t&&(this.onRemoved=t,!0)}setOnSelectedCallback(t){return this.onSelected!==t&&(this.onSelected=t,!0)}setOnDeselectedCallback(t){return this.onDeselected!==t&&(this.onDeselected=t,!0)}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=-1:this.currentStep++}isDrawing(){return-1!==this.currentStep}isStart(){return 1===this.currentStep}eventMoveForDrawing(t){var e;const i=this.currentStep-1,n={};void 0!==t.timestamp&&(n.timestamp=t.timestamp),void 0!==t.dataIndex&&(n.dataIndex=t.dataIndex),void 0!==t.value&&(n.value=t.value),this.points[i]=n,null===(e=this.performEventMoveForDrawing)||void 0===e||e.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:i,performPoint:n})}eventPressedPointMove(t,e){var i;void 0!==t.dataIndex&&(this.points[e].dataIndex=t.dataIndex,this.points[e].timestamp=t.timestamp),void 0!==t.value&&(this.points[e].value=t.value),null===(i=this.performEventPressedMove)||void 0===i||i.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:e,performPoint:this.points[e]})}startPressedMove(t){this._prevPressedPoint={...t},this._prevPressedPoints=c(this.points)}eventPressedOtherMove(t,e){if(null!==this._prevPressedPoint){let i,n;void 0!==t.dataIndex&&void 0!==this._prevPressedPoint.dataIndex&&(i=t.dataIndex-this._prevPressedPoint.dataIndex),void 0!==t.value&&void 0!==this._prevPressedPoint.value&&(n=t.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map((t=>{var s;void 0===t.dataIndex&&void 0!==t.timestamp&&(t.dataIndex=e.timestampToDataIndex(t.timestamp));const o={...t};return void 0!==i&&void 0!==t.dataIndex&&(o.dataIndex=t.dataIndex+i,o.timestamp=null!==(s=e.dataIndexToTimestamp(o.dataIndex))&&void 0!==s?s:void 0),void 0!==n&&void 0!==t.value&&(o.value=t.value+n),o}))}}static extend(t){return class extends z{constructor(){super(t)}}}}function W(t,e){return Math.sqrt(Math.pow(t.x+e.x,2)+Math.pow(t.y+e.y,2))}function Y(t){const e=W(t[0],t[1]),i=e+W(t[1],t[2]),n=[t[2].x-t[0].x,t[2].y-t[0].y];return[{x:t[1].x-.5*n[0]*e/i,y:t[1].y-.5*n[1]*e/i},{x:t[1].x+.5*n[0]*e/i,y:t[1].y+.5*n[1]*e/i}]}function H(t,e){let i=!1;const n=e.coordinates;if(n.length>1)for(let e=1;e<n.length;e++){const s=n[e-1],o=n[e];if(s.x===o.x)i=Math.abs(t.x-s.x)<2;else{const e=j(s,o),n=X(e,t),r=Math.abs(n-t.y);i=r*r/(e[0]*e[0]+1)<4}if(i)return i}return i}function X(t,e){return null!=t?e.x*t[0]+t[1]:e.y}function $(t,e,i){return X(j(t,e),i)}function j(t,e){const i=t.x-e.x;if(0!==i){const n=(t.y-e.y)/i;return[n,t.y-n*t.x]}return null}function G(t,e,i){const{coordinates:n}=e,s=n.length;if(s>1){const{style:e="solid",smooth:o,size:r=1,color:a="currentColor",dashedValue:l=[2,2]}=i;if(t.lineWidth=r,t.strokeStyle=a,"dashed"===e?t.setLineDash(l):t.setLineDash([]),t.beginPath(),t.moveTo(n[0].x,n[0].y),null!=o&&o){let e=[];for(let t=1;t<s-1;t++)e=e.concat(Y([n[t-1],n[t],n[t+1]]));t.quadraticCurveTo(e[0].x,e[0].y,n[1].x,n[1].y);let i=2;for(;i<s-1;i++)t.bezierCurveTo(e[2*(i-2)+1].x,e[2*(i-2)+1].y,e[2*(i-1)].x,e[2*(i-1)].y,n[i].x,n[i].y);t.quadraticCurveTo(e[2*(i-2)+1].x,e[2*(i-2)+1].y,n[i].x,n[i].y)}else for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.stroke(),t.closePath()}}const U={name:"line",checkEventOn:H,draw:(t,e,i)=>{G(t,e,i)}};function Z(t,e,i){const n=null!=i?i:0,s=[];if(t.length>1)if(t[0].x===t[1].x){const i=0,o=e.height;if(s.push({coordinates:[{x:t[0].x,y:i},{x:t[0].x,y:o}]}),t.length>2){s.push({coordinates:[{x:t[2].x,y:i},{x:t[2].x,y:o}]});const e=t[0].x-t[2].x;for(let r=0;r<n;r++){const n=e*(r+1);s.push({coordinates:[{x:t[0].x+n,y:i},{x:t[0].x+n,y:o}]})}}}else{const i=0,o=e.width,r=j(t[0],t[1]),a=r[0],l=r[1];if(s.push({coordinates:[{x:i,y:i*a+l},{x:o,y:o*a+l}]}),t.length>2){const e=t[2].y-a*t[2].x;s.push({coordinates:[{x:i,y:i*a+e},{x:o,y:o*a+e}]});const r=l-e;for(let t=0;t<n;t++){const e=l+r*(t+1);s.push({coordinates:[{x:i,y:i*a+e},{x:o,y:o*a+e}]})}}}return s}function q(t,e){if(t.length>1){let i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:$(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:$(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}const K={name:"simpleAnnotation",createPointFigures:({overlay:t,coordinates:e})=>{var i;let n;v(t.extendData)&&(n=u(t.extendData)?t.extendData(t):null!==(i=t.extendData)&&void 0!==i?i:"");const s=e[0].x,o=e[0].y-6,r=o-50,a=r-5;return[{type:"line",attrs:{coordinates:[{x:s,y:o},{x:s,y:r}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:s,y:r},{x:s-4,y:a},{x:s+4,y:a}]},ignoreEvent:!0},{type:"rectText",attrs:{x:s,y:a,text:null!=n?n:"",align:"center",baseline:"bottom"},ignoreEvent:!0}]}},J={name:"simpleTag",createPointFigures:({bounding:t,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:t.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({overlay:t,coordinates:e,bounding:i,yAxis:n,precision:s})=>{var o,r;let a,l,c;return null!==(o=null==n?void 0:n.isFromZero())&&void 0!==o&&o?(a="left",l=0):(a="right",l=i.width),v(t.extendData)&&(c=u(t.extendData)?t.extendData(t):null!==(r=t.extendData)&&void 0!==r?r:""),v(c)||void 0===t.points[0].value||(c=y(t.points[0].value,s.price)),{type:"rectText",attrs:{x:l,y:e[0].y,text:null!=c?c:"",align:a,baseline:"middle"}}}},Q={};function tt(t){var e;return null!==(e=Q[t])&&void 0!==e?e:null}function et(t){const e={width:0,height:0,left:0,right:0,top:0,bottom:0};return void 0!==t&&l(e,t),e}[{name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e,overlay:i,precision:n})=>{const s=i.points;if(t.length>0){const i=[],o=[],r=0,a=e.width,l=s[1].value;if(t.length>1&&void 0!==s[0].value&&void 0!==l){const e=[1,.786,.618,.5,.382,.236,0],c=t[0].y-t[1].y,h=s[0].value-l;e.forEach((e=>{const s=t[1].y+c*e,u=(l+h*e).toFixed(n.price);i.push({coordinates:[{x:r,y:s},{x:a,y:s}]}),o.push({x:r,y:s,text:`${u} (${(100*e).toFixed(1)}%)`,baseline:"bottom"})}))}return[{type:"line",attrs:i},{type:"text",isCheckEvent:!1,attrs:o}]}return[]}},{name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{const i={x:0,y:t[0].y};return void 0!==t[1]&&t[0].x<t[1].x&&(i.x=e.width),[{type:"line",attrs:{coordinates:[t[0],i]}}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},{name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=[];return 2===t.length&&e.push({coordinates:t}),[{type:"line",attrs:e}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},{name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]}}]},{name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:Z(t,e)}]},{name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:Z(t,e,1)}]},{name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e,precision:i,overlay:n})=>{const{value:s=0}=n.points[0];return[{type:"line",attrs:{coordinates:[t[0],{x:e.width,y:t[0].y}]}},{type:"text",isCheck:!1,attrs:{x:t[0].x,y:t[0].y,text:s.toFixed(i.price),baseline:"bottom"}}]}},{name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:q(t,e)}]},{name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[]},{name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>2===t.length?t[0].x===t[1].x?[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:$(t[0],t[1],{x:0,y:t[0].y})},{x:e.width,y:$(t[0],t[1],{x:e.width,y:t[0].y})}]}}]:[]},{name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{if(2===t.length){const i={x:t[0].x,y:0};return t[0].y<t[1].y&&(i.y=e.height),[{type:"line",attrs:{coordinates:[t[0],i]}}]}return[]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[],performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]},K,J].forEach((t=>{Q[t.name]=z.extend(t)}));class it{constructor(){this._children=[],this._callbacks=new Map}registerEvent(t,e){return this._callbacks.set(t,e),this}onEvent(t,e,i){const n=this._callbacks.get(t);return!(void 0===n||!this.checkEventOn(e))&&n(e,i)}checkEventOn(t){for(const e of this._children)if(e.checkEventOn(t))return!0;return!1}dispatchEvent(t,e,i){const n=this._children.length-1;if(n>-1)for(let s=n;s>-1;s--)if(this._children[s].dispatchEvent(t,e,i))return!0;return this.onEvent(t,e,i)}addChild(t){return this._children.push(t),this}clear(){this._children=[]}}const nt="main",st="xAxis",ot="yAxis",rt="separator";class at extends it{constructor(t,e){super(),this._bounding=et(),this._pane=e,this._init(t)}_init(t){if(this._container=n("div",this.getContainerStyle()),this.insertBefore()){const e=t.lastChild;null!==e?t.insertBefore(this._container,e):t.appendChild(this._container)}else t.appendChild(this._container);this.initDom(this._container)}setBounding(t){return l(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}update(t){this.updateImp(t,this._container,this._bounding)}insertBefore(){return!1}}class lt extends at{constructor(t,e){super(t,e),this._dragFlag=!1,this._dragStartY=0,this._topPaneHeight=0,this._currentPaneHeight=0,this._pressedMouseMoveEvent=function(t,e){let i=0;return function(){const n=Date.now();n-i>(null!=e?e:20)&&(t.apply(this,arguments),i=n)}}(this._pressedTouchMouseMoveEvent,20),this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return rt}checkEventOn(){return!0}_mouseDownEvent(t){var e,i;this._dragFlag=!0,this._dragStartY=t.pageY;const n=this.getPane();return this._topPaneHeight=null!==(i=null===(e=n.getTopPane())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,this._currentPaneHeight=n.getBounding().height,!0}_mouseUpEvent(){return this._dragFlag=!1,this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const e=t.pageY-this._dragStartY,i=this.getPane(),n=i.getTopPane(),s=e<0;if(null!==n&&i.getOptions().dragEnabled){let t,o,r,a;s?(t=n,o=i,r=this._topPaneHeight,a=this._currentPaneHeight):(t=i,o=n,r=this._currentPaneHeight,a=this._topPaneHeight);const l=t.getOptions().minHeight;if(r>l){const n=Math.max(r-Math.abs(e),l),s=r-n;t.setBounding({height:n}),o.setBounding({height:a+s});const c=i.getChart();c.getChartStore().getActionStore().execute("onPaneDrag",{paneId:i.getId}),c.adjustPaneViewport(!0,!0,!0,!0,!0)}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getOptions().dragEnabled){const e=t.getChart(),i=e.getStyles().separator;this._moveDom.style.background=i.activeBackgroundColor;const n=e.getChartStore();return n.setDragPaneFlag(!0),n.getCrosshairStore().set(),!0}return!1}_mouseLeaveEvent(){return!this._dragFlag&&(this._moveDom.style.background="",this.getPane().getChart().getChartStore().setDragPaneFlag(!1),!0)}getContainerStyle(){return{margin:"0",padding:"0",position:"relative",boxSizing:"border-box"}}insertBefore(){return!0}initDom(t){this._moveDom=n("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"}),t.appendChild(this._moveDom)}updateImp(t,e,i){if(4===t||2===t){const t=this.getPane().getChart().getStyles().separator;this._moveDom.style.top=-Math.floor((7-t.size)/2)+"px",this._moveDom.style.height="7px";const n=t.fill;e.style.backgroundColor=t.color,e.style.height=`${t.size}px`,e.style.marginLeft=`${n?0:i.left}px`,e.style.width=n?"100%":`${i.width}px`}}getImage(){const t=this.getPane().getChart().getStyles().separator,e=this.getContainer().offsetWidth,i=t.size,s=n("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),r=s.getContext("2d"),a=o(s);return s.width=e*a,s.height=i*a,r.scale(a,a),r.fillStyle=t.color,r.fillRect(this.getBounding().left,0,e,i),s}}const ct={CANDLE:"candle_pane",INDICATOR:"indcator_pane_",XAXIS:"xaxis_pane"};class ht{constructor(t,e,i,n,s){this._yAxisWidget=null,this._separatorWidget=null,this._axis=this.createAxisComponent(),this._bounding=et(),this._options={minHeight:30,dragEnabled:!0,gap:{top:.2,bottom:.1}},this._chart=e,this._id=i,this._topPane=null!=n?n:null,this._bottomPane=null!=s?s:null,this._init(t)}_init(t){this._container=t,this._seriesContiainer=n("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._separatorWidget=this.createSeparatorWidget(t);const e=t.lastChild;null!==e?t.insertBefore(this._seriesContiainer,e):t.appendChild(this._seriesContiainer),this._mainWidget=this.createMainWidget(this._seriesContiainer),this._yAxisWidget=this.creatYAxisWidget(this._seriesContiainer)}getContainer(){return this._seriesContiainer}getId(){return this._id}setOptions(t){return l(this._options,t),this}getOptions(){return this._options}getChart(){return this._chart}getAxisComponent(){return this._axis}setBounding(t,e,i){var n,s,o;l(this._bounding,t);let r=0;if(null!==this._separatorWidget){r=this._chart.getStyles().separator.size;const e={...t,height:7};void 0!==t.top&&(e.top=t.top-Math.floor((7-r)/2)),this._separatorWidget.setBounding(e)}const a={};return void 0!==t.height&&(a.height=t.height-r),void 0!==t.top&&(a.top=t.top+r),this._mainWidget.setBounding(a),null===(n=this._yAxisWidget)||void 0===n||n.setBounding(a),void 0!==e&&(this._mainWidget.setBounding(e),null===(s=this._separatorWidget)||void 0===s||s.setBounding(e)),void 0!==i&&(null===(o=this._yAxisWidget)||void 0===o||o.setBounding(i)),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getBounding(){return this._bounding}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}getSeparatorWidget(){return this._separatorWidget}update(t){var e,i;this._bounding.width!==this._seriesContiainer.offsetWidth&&(this._seriesContiainer.style.width=`${this._bounding.width}px`);const n=this._mainWidget.getBounding().height;n!==this._seriesContiainer.offsetHeight&&(this._seriesContiainer.style.height=`${n}px`);const s=null!=t?t:3;this._mainWidget.update(s),null===(e=this._yAxisWidget)||void 0===e||e.update(s),null===(i=this._separatorWidget)||void 0===i||i.update(s)}getImage(t){const{width:e,height:i}=this._bounding,s=n("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),r=s.getContext("2d"),a=o(s);s.width=e*a,s.height=i*a,r.scale(a,a);let l=0;if(null!=this._separatorWidget){const t=this.getChart().getStyles().separator.size;l=t,r.drawImage(this._separatorWidget.getImage(),0,0,e,t)}const c=this._mainWidget.getBounding();if(r.drawImage(this._mainWidget.getImage(t),c.left,l,c.width,c.height),null!==this._yAxisWidget){const e=this._yAxisWidget.getBounding();r.drawImage(this._yAxisWidget.getImage(t),e.left,l,e.width,e.height)}return s}destroy(){this._container.removeChild(this._seriesContiainer),null!==this._separatorWidget&&this._container.removeChild(this._separatorWidget.getContainer())}createSeparatorWidget(t){return null}creatYAxisWidget(t){return null}}class ut{constructor(t){this._instances=new Map,this._progressInstanceInfo=null,this._pressedInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._hoverInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._clickInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._chartStore=t}_overrideInstance(t,e){const{id:i,groupId:n,points:s,styles:o,lock:r,mode:a,extendData:l,onDrawStart:c,onDrawing:h,onDrawEnd:u,onClick:d,onRightClick:g,onPressedMoveStart:v,onPressedMoving:m,onPressedMoveEnd:p,onMouseEnter:_,onMouseLeave:x,onRemoved:f,onSelected:y,onDeselected:S}=e;let C=!1;return void 0!==i&&t.setId(i),void 0!==n&&t.setGroupId(n),void 0!==s&&t.setPoints(s)&&(C=!0),void 0!==o&&t.setStyles(o)&&(C=!0),void 0!==r&&t.setLock(r),void 0!==a&&t.setMode(a),void 0!==l&&t.setExtendData(l)&&(C=!0),void 0!==c&&t.setOnDrawStartCallback(c),void 0!==h&&t.setOnDrawingCallback(h),void 0!==u&&t.setOnDrawEndCallback(u),void 0!==d&&t.setOnClickCallback(d),void 0!==g&&t.setOnRightClickCallback(g),void 0!==v&&t.setOnPressedMoveStartCallback(v),void 0!==m&&t.setOnPressedMovingCallback(m),void 0!==p&&t.setOnPressedMoveEndCallback(p),void 0!==_&&t.setOnMouseEnterCallback(_),void 0!==x&&t.setOnMouseLeaveCallback(x),void 0!==f&&t.setOnRemovedCallback(f),void 0!==y&&t.setOnSelectedCallback(y),void 0!==S&&t.setOnDeselectedCallback(S),C}getInstanceById(t){for(const e of this._instances){const i=e[1].find((e=>e.id===t));if(void 0!==i)return i}return null!==this._progressInstanceInfo&&this._progressInstanceInfo.instance.id===t?this._progressInstanceInfo.instance:null}addInstance(t,e,n){var s,o,r,a;const l=null!==(s=t.id)&&void 0!==s?s:i("overlay_");if(null===this.getInstanceById(l)){const i=new(tt(t.name)),s=null!==(o=t.groupId)&&void 0!==o?o:l;return t.id=l,t.groupId=s,this._overrideInstance(i,t),i.isDrawing()?this._progressInstanceInfo={paneId:e,instance:i,appointPaneFlag:n}:(this._instances.has(e)||this._instances.set(e,[]),null===(r=this._instances.get(e))||void 0===r||r.push(i)),null===(a=i.onDrawStart)||void 0===a||a.call(i,{overlay:i}),this._chartStore.getChart().updatePane(1,e),l}return null}getProgressInstanceInfo(){return this._progressInstanceInfo}progressInstanceComplete(){var t;if(null!==this._progressInstanceInfo){const{instance:e,paneId:i}=this._progressInstanceInfo;e.isDrawing()||(this._instances.has(i)||this._instances.set(i,[]),null===(t=this._instances.get(i))||void 0===t||t.push(e),this._progressInstanceInfo=null)}}updateProgressInstanceInfo(t,e){null!==this._progressInstanceInfo&&(void 0!==e&&e&&(this._progressInstanceInfo.appointPaneFlag=e),this._progressInstanceInfo.paneId=t)}getInstances(t){var e;if(void 0===t){let t=[];return this._instances.forEach((e=>{t=t.concat(e)})),t}return null!==(e=this._instances.get(t))&&void 0!==e?e:[]}override(t){const{id:e,groupId:i,name:n}=t;let s=!1;if(void 0!==e){const i=this.getInstanceById(e);null!==i&&this._overrideInstance(i,t)&&(s=!0)}else if(this._instances.forEach((e=>{e.forEach((e=>{(void 0!==n&&e.name===n||void 0!==i&&e.groupId===i||void 0===n&&void 0===i)&&this._overrideInstance(e,t)&&(s=!0)}))})),null!==this._progressInstanceInfo){const e=this._progressInstanceInfo.instance;(void 0!==n&&e.name===n||void 0!==i&&e.groupId===i||void 0===n&&void 0===i)&&this._overrideInstance(e,t)&&(s=!0)}s&&this._chartStore.getChart().updatePane(1)}removeInstance(t){var e;const i=(t,e)=>{if(void 0!==t.id){if(e.id!==t.id)return!1}else if(void 0!==t.groupId){if(e.groupId!==t.groupId)return!1}else if(void 0!==t.name&&e.name!==t.name)return!1;return!0},n=[];if(null!==this._progressInstanceInfo){const s=this._progressInstanceInfo.instance;(void 0===t||void 0!==t&&i(t,s))&&(n.push(this._progressInstanceInfo.paneId),null===(e=s.onRemoved)||void 0===e||e.call(s,{overlay:s}),this._progressInstanceInfo=null)}if(void 0!==t){const e=new Map;for(const s of this._instances){const o=s[1].filter((e=>{var o;return!i(t,e)||(n.includes(s[0])||n.push(s[0]),null===(o=e.onRemoved)||void 0===o||o.call(e,{overlay:e}),!1)}));o.length>0&&e.set(s[0],o)}this._instances=e}else this._instances.forEach(((t,e)=>{n.push(e),t.forEach((t=>{var e;null===(e=t.onRemoved)||void 0===e||e.call(t,{overlay:t})}))})),this._instances.clear();if(n.length>0){const t=this._chartStore.getChart();n.forEach((e=>{t.updatePane(1,e)})),t.updatePane(1,ct.XAXIS)}}setPressedInstanceInfo(t){this._pressedInstanceInfo=t}getPressedInstanceInfo(){return this._pressedInstanceInfo}setHoverInstanceInfo(t,e){var i,n,s,o,r;const{instance:a,figureType:l,figureIndex:c}=this._hoverInstanceInfo;(null==a?void 0:a.id)===(null===(i=t.instance)||void 0===i?void 0:i.id)&&l===t.figureType&&c===t.figureIndex||(this._hoverInstanceInfo=t,(null==a?void 0:a.id)!==(null===(n=t.instance)||void 0===n?void 0:n.id)&&(null===(s=null==a?void 0:a.onMouseLeave)||void 0===s||s.call(a,{overlay:a,...e}),null===(r=null===(o=t.instance)||void 0===o?void 0:o.onMouseEnter)||void 0===r||r.call(o,{overlay:t.instance,...e})))}getHoverInstanceInfo(){return this._hoverInstanceInfo}setClickInstanceInfo(t,e){var i,n,s,o,r,a,l,c,h;const{paneId:u,instance:d,figureType:g,figureIndex:v}=this._clickInstanceInfo;if(null!==(n=null===(i=t.instance)||void 0===i?void 0:i.isDrawing())&&void 0!==n&&n||null===(o=null===(s=t.instance)||void 0===s?void 0:s.onClick)||void 0===o||o.call(s,{overlay:t.instance,...e}),((null==d?void 0:d.id)!==(null===(r=t.instance)||void 0===r?void 0:r.id)||g!==t.figureType||v!==t.figureIndex)&&(this._clickInstanceInfo=t,(null==d?void 0:d.id)!==(null===(a=t.instance)||void 0===a?void 0:a.id))){null===(l=null==d?void 0:d.onDeselected)||void 0===l||l.call(d,{overlay:d,...e}),null===(h=null===(c=t.instance)||void 0===c?void 0:c.onSelected)||void 0===h||h.call(c,{overlay:t.instance,...e});const i=this._chartStore.getChart();i.updatePane(1,t.paneId),u!==t.paneId&&i.updatePane(1,u),i.updatePane(1,ct.XAXIS)}}getClickInstanceInfo(){return this._clickInstanceInfo}isEmpty(){return 0===this._instances.size&&null===this._progressInstanceInfo}isDrawing(){var t,e;return null!==this._progressInstanceInfo&&null!==(e=null===(t=this._progressInstanceInfo)||void 0===t?void 0:t.instance.isDrawing())&&void 0!==e&&e}}class dt{constructor(){this._callbacks=[]}subscribe(t){var e;(null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1)<0&&this._callbacks.push(t)}unsubscribe(t){var e;if(void 0!==t){const i=null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1;i>-1&&this._callbacks.splice(i,1)}else this._callbacks=[]}execute(t){this._callbacks.forEach((e=>{e(t)}))}isEmpty(){return 0===this._callbacks.length}}class gt{constructor(){this._actions=new Map}execute(t,e){var i;null===(i=this._actions.get(t))||void 0===i||i.execute(e)}subscribe(t,e){var i;this._actions.has(t)||this._actions.set(t,new dt),null===(i=this._actions.get(t))||void 0===i||i.subscribe(e)}unsubscribe(t,e){const i=this._actions.get(t);void 0!==i&&(i.unsubscribe(e),i.isEmpty()&&this._actions.delete(t))}has(t){const e=this._actions.get(t);return void 0!==e&&!e.isEmpty()}}const vt={light:{grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},text:{color:"#76808F"}}},indicator:{tooltip:{text:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},dark:{grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}}};function mt(t){var e;return null!==(e=vt[t])&&void 0!==e?e:null}class pt{constructor(t,e){this._styles={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}},candle:{type:"candle_solid",bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#1677FF",value:"close",backgroundColor:[{offset:0,color:"rgba(22, 119, 255, 0.01)"},{offset:1,color:"rgba(22, 119, 255, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:"always",showType:"standard",custom:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},indicator:{ohlc:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lines:[{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#FF9600"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#9D65C9"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#1677FF"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#E11D74"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#01C5C4"}],circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{showRule:"always",showType:"standard",showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,size:"auto",type:"normal",position:"right",inside:!1,reverse:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:"#686D76",borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#686D76",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}}},overlay:{point:{color:"#1677FF",borderColor:"rgba(22, 119, 255, 0.35)",borderSize:1,radius:5,activeColor:"#1677FF",activeBorderColor:"rgba(22, 119, 255, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:"#1677FF",size:1,dashedValue:[2,2]},rect:{style:"fill",color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:"#1677FF",borderColor:"#1677FF",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:"#1677FF",size:1,dashedValue:[2,2]},text:{color:"#1677FF",size:12,family:"Helvetica Neue",weight:"normal"},rectText:{style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#1677FF",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#1677FF"}}},this._customApi={formatDate:f,formatBigNumber:S},this._locale="en-US",this._precision={price:2,volume:0},this._dataList=[],this._dragPaneFlag=!1,this._timeScaleStore=new M(this),this._indicatorStore=new V(this),this._overlayStore=new ut(this),this._crosshairStore=new O(this),this._actionStore=new gt,this._visibleDataList=[],this._chart=t,this.setOptions(e)}adjustVisibleDataList(){this._visibleDataList=[];const{from:t,to:e}=this._timeScaleStore.getVisibleRange();for(let i=t;i<e;i++){const t=this._dataList[i],e=this._timeScaleStore.dataIndexToCoordinate(i);this._visibleDataList.push({dataIndex:i,x:e,data:t})}}setOptions(t){if(void 0!==t){const{locale:e,timezone:i,styles:n,customApi:s}=t;void 0!==e&&(this._locale=e),void 0!==i&&this._timeScaleStore.setTimezone(i),void 0!==n&&(m(n)?l(this._styles,mt(n)):l(this._styles,n)),void 0!==s&&l(this._customApi,s)}return this}getStyles(){return this._styles}getLocale(){return this._locale}getCustomApi(){return this._customApi}getPrecision(){return this._precision}setPrecision(t){return this._precision=t,this._indicatorStore.setSeriesPrecision(t),this}getDataList(){return this._dataList}getVisibleDataList(){return this._visibleDataList}addData(t,e,i){if(h(t)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(null==i||i);const e=0===this._dataList.length;this._dataList=t.concat(this._dataList),e&&this._timeScaleStore.resetOffsetRightDistance(),this._timeScaleStore.adjustVisibleRange()}else{if(e>=this._dataList.length){this._dataList.push(t);let e=this._timeScaleStore.getOffsetRightBarCount();e<0&&this._timeScaleStore.setOffsetRightBarCount(--e),this._timeScaleStore.adjustVisibleRange()}else this._dataList[e]=t,this.adjustVisibleDataList()}this._crosshairStore.recalculate(!0)}clearDataList(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear()}getTimeScaleStore(){return this._timeScaleStore}getIndicatorStore(){return this._indicatorStore}getOverlayStore(){return this._overlayStore}getCrosshairStore(){return this._crosshairStore}getActionStore(){return this._actionStore}getChart(){return this._chart}getDragPaneFlag(){return this._dragPaneFlag}setDragPaneFlag(t){return this._dragPaneFlag=t,this}}function _t(t){return null==window.requestAnimationFrame?window.setTimeout(t,20):window.requestAnimationFrame(t)}function xt(t){null==window.cancelAnimationFrame&&window.clearTimeout(t),window.cancelAnimationFrame(t)}const ft=-1;class yt extends at{constructor(){super(...arguments),this._mainRequestAnimationId=ft,this._overlayRequestAnimationId=ft}getContainerStyle(){return{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box"}}initDom(t){this._mainCanvas=n("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._mainCtx=this._mainCanvas.getContext("2d"),this._overlayCanvas=n("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._overlayCtx=this._overlayCanvas.getContext("2d"),t.appendChild(this._mainCanvas),t.appendChild(this._overlayCanvas)}_optimalUpdateMain(){this._mainRequestAnimationId!==ft&&(xt(this._mainRequestAnimationId),this._mainRequestAnimationId=ft),this._mainRequestAnimationId=_t((()=>{this.updateMain(this._mainCtx)}))}_optimalUpdateOverlay(){this._overlayRequestAnimationId!==ft&&(xt(this._overlayRequestAnimationId),this._overlayRequestAnimationId=ft),this._overlayRequestAnimationId=_t((()=>{this.updateOverlay(this._overlayCtx)}))}updateImp(t,e,i){const{width:n,height:s,left:r}=i;e.style.left=`${r}px`;let a=t;if(n!==e.offsetWidth||s!==e.offsetHeight){this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);const t=`${n}px`,i=`${s}px`;e.style.width=t,e.style.height=i;const r=o(this._mainCanvas),l=Math.floor(n*r),c=Math.floor(s*r);this._mainCanvas.style.width=t,this._mainCanvas.style.height=i,this._mainCanvas.width=l,this._mainCanvas.height=c,this._mainCtx.scale(r,r),this._overlayCanvas.style.width=t,this._overlayCanvas.style.height=i,this._overlayCanvas.width=l,this._overlayCanvas.height=c,this._overlayCtx.scale(r,r),a=3}else 4!==a&&3!==a&&0!==a||this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),4!==a&&3!==a&&1!==a||this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);switch(a){case 0:this._optimalUpdateMain();break;case 1:this._optimalUpdateOverlay();break;case 3:case 4:this._optimalUpdateMain(),this._optimalUpdateOverlay()}}getImage(t){const{width:e,height:i}=this.getBounding(),s=n("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),r=s.getContext("2d"),a=o(s);return s.width=e*a,s.height=i*a,r.scale(a,a),r.drawImage(this._mainCanvas,0,0,e,i),t&&r.drawImage(this._overlayCanvas,0,0,e,i),s}}const St=2;class Ct extends it{constructor(t){super(),this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){return class extends Ct{checkEventOnImp(e,i,n){return t.checkEventOn(e,i,n)}drawImp(e,i,n){t.draw(e,i,n)}}}}function bt(t,e){const i=t.x-e.x,n=t.y-e.y,s=e.r;return!(i*i+n*n>s*s)}function wt(t,e,i){const{x:n,y:s,r:o}=e,{style:r="fill",color:a="currentColor",borderSize:l=1,borderColor:c="currentColor",borderStyle:h="solid",borderDashedValue:u=[2,2]}=i;"fill"!==r&&"stroke_fill"!==i.style||(t.fillStyle=a,t.beginPath(),t.arc(n,s,o,0,2*Math.PI),t.closePath(),t.fill()),"stroke"!==r&&"stroke_fill"!==i.style||(t.strokeStyle=c,t.lineWidth=l,"dashed"===h?t.setLineDash(u):t.setLineDash([]),t.beginPath(),t.arc(n,s,o,0,2*Math.PI),t.closePath(),t.stroke())}const Et={name:"circle",checkEventOn:bt,draw:(t,e,i)=>{wt(t,e,i)}};function It(t,e){let i=!1;const n=e.coordinates;for(let e=0,s=n.length-1;e<n.length;s=e++)n[e].y>t.y!=n[s].y>t.y&&t.x<(n[s].x-n[e].x)*(t.y-n[e].y)/(n[s].y-n[e].y)+n[e].x&&(i=!i);return i}function Tt(t,e,i){const{coordinates:n}=e,{style:s="fill",color:o="currentColor",borderSize:r=1,borderColor:a="currentColor",borderStyle:l="solid",borderDashedValue:c=[2,2]}=i;if("fill"===s||"stroke_fill"===i.style){t.fillStyle=o,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.fill()}if("stroke"===s||"stroke_fill"===i.style){t.strokeStyle=a,t.lineWidth=r,"dashed"===l?t.setLineDash(c):t.setLineDash([]),t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.stroke()}}const Dt={name:"polygon",checkEventOn:It,draw:(t,e,i)=>{Tt(t,e,i)}};function Mt(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}function Pt(t,e,i){const{x:n,y:s,width:o,height:r}=e,{style:a="fill",color:l="currentColor",borderSize:c=1,borderColor:h="currentColor",borderStyle:u="solid",borderRadius:d=0,borderDashedValue:g=[2,2]}=i;"fill"!==a&&"stroke_fill"!==i.style||(t.fillStyle=l,t.beginPath(),t.moveTo(n+d,s),t.arcTo(n+o,s,n+o,s+r,d),t.arcTo(n+o,s+r,n,s+r,d),t.arcTo(n,s+r,n,s,d),t.arcTo(n,s,n+o,s,d),t.closePath(),t.fill()),"stroke"!==a&&"stroke_fill"!==i.style||(t.strokeStyle=h,t.lineWidth=c,"dashed"===u?t.setLineDash(g):t.setLineDash([]),t.beginPath(),t.moveTo(n+d,s),t.arcTo(n+o,s,n+o,s+r,d),t.arcTo(n+o,s+r,n,s+r,d),t.arcTo(n,s+r,n,s,d),t.arcTo(n,s,n+o,s,d),t.closePath(),t.stroke())}const kt={name:"rect",checkEventOn:Mt,draw:(t,e,i)=>{Pt(t,e,i)}};function At(t,e,i){const{size:n=12,paddingLeft:s=0,paddingTop:o=0,paddingRight:r=0,paddingBottom:a=0}=e,{x:l,y:c,text:h,align:u="left",baseline:d="top"}=t,g=h.length;i=null!=i?i:n*g;const v=n;let m,p;switch(u){case"left":case"start":m=l;break;case"right":case"end":m=l-r-i-s;break;default:m=l-i/2-s}switch(d){case"top":case"hanging":p=c;break;case"bottom":case"ideographic":case"alphabetic":p=c-v-o-a;break;default:p=c-v/2-o}return{x:m,y:p,width:s+i+r,height:o+v+a}}function Ft(t,e,i){const{x:n,y:s,width:o,height:r}=At(e,i);return t.x>=n&&t.x<=n+o&&t.y>=s&&t.y<=s+r}function Lt(t,e,i){const{x:n,y:s,text:o,align:a="left",baseline:l="top"}=e,{color:c="currentColor",size:h=12,family:u,weight:d}=i;t.textAlign=a,t.textBaseline=l,t.font=r(h,d,u),t.fillStyle=c,t.fillText(o,n,s)}const Bt={name:"text",checkEventOn:(t,e,i)=>Ft(t,e,i),draw:(t,e,i)=>{Lt(t,e,i)}};function Rt(t,e,i){const{text:n}=e,{size:s=12,family:o,weight:a,paddingLeft:l=0,paddingTop:c=0}=i;t.font=r(s,a,o);const h=At(e,i,t.measureText(n).width);Pt(t,h,{...i,color:i.backgroundColor}),Lt(t,{x:h.x+l,y:h.y+c,text:n,align:"left",baseline:"top"},i)}const Nt={name:"rectText",checkEventOn:(t,e,i)=>Ft(t,e,i),draw:(t,e,i)=>{Rt(t,e,i)}},Vt={};[Et,U,Dt,kt,Bt,Nt].forEach((t=>{Vt[t.name]=Ct.extend(t)}));class Ot extends it{constructor(t){super(),this._widget=t}getWidget(){return this._widget}createFigure(t,e,i,n){const s=function(t){var e;return null!==(e=Vt[t])&&void 0!==e?e:null}(t);if(null!==s){const o=new s({name:t,attrs:e,styles:i});if(void 0!==n){for(const t in n)n.hasOwnProperty(t)&&o.registerEvent(t,n[t]);this.addChild(o)}return o}return null}draw(t){this.clear(),this.drawImp(t)}}class zt extends Ot{drawImp(t){var e;const i=this.getWidget(),n=this.getWidget().getPane(),s=n.getChart(),o=i.getBounding(),r=s.getStyles().grid;if(r.show){t.save(),t.globalCompositeOperation="destination-over";const i=r.horizontal;if(i.show){(null===(e=s.getPaneById(ct.XAXIS))||void 0===e?void 0:e.getAxisComponent()).getTicks().forEach((e=>{var n;null===(n=this.createFigure("line",{coordinates:[{x:e.coord,y:0},{x:e.coord,y:o.height}]},i))||void 0===n||n.draw(t)}))}const a=r.vertical;if(a.show){n.getAxisComponent().getTicks().forEach((e=>{var i;null===(i=this.createFigure("line",{coordinates:[{x:0,y:e.coord},{x:o.width,y:e.coord}]},a))||void 0===i||i.draw(t)}))}t.restore()}}}class Wt extends Ot{eachChildren(t){const e=this.getWidget().getPane().getChart().getChartStore(),i=e.getVisibleDataList(),n=e.getTimeScaleStore().getBarSpace();i.forEach(((e,i)=>{t(e,n,i)}))}}class Yt extends Wt{drawImp(t){const e=this.getWidget().getPane(),i=e.getChart().getChartStore(),n=this.getCandleBarOptions(i);if(null!==n){const i=e.getAxisComponent();this.eachChildren(((e,s)=>{this._drawCandleBar(t,i,e,s,n)}))}}getCandleBarOptions(t){const e=t.getStyles().candle;return{type:e.type,styles:e.bar}}_drawCandleBar(t,e,i,n,s){const{data:o,x:r}=i,{open:a,high:l,low:c,close:h}=o,{halfGapBar:u,gapBar:d}=n,{type:g,styles:v}=s;let m;m=h>a?v.upColor:h<a?v.downColor:v.noChangeColor;const p=e.convertToPixel(a),_=e.convertToPixel(h),x=[p,_,e.convertToPixel(l),e.convertToPixel(c)];x.sort(((t,e)=>t-e));const f=Math.max(1,x[2]-x[1]);let y=[];"ohlc"!==g?(y.push({name:"rect",attrs:{x:r-.5,y:x[0],width:1,height:x[1]-x[0]},styles:{color:m}}),"candle_stroke"===g||"candle_up_stroke"===g&&a<h||"candle_down_stroke"===g&&a>h?y.push({name:"rect",attrs:{x:r-u+.5,y:x[1],width:d-1,height:f},styles:{style:"stroke",borderColor:m}}):y.push({name:"rect",attrs:{x:r-u,y:x[1],width:d,height:f},styles:{color:m}}),y.push({name:"rect",attrs:{x:r-.5,y:x[2],width:1,height:x[3]-x[2]},styles:{color:m}})):y=[{name:"rect",attrs:{x:r-.5,y:x[0],width:1,height:x[3]-x[0]},styles:{color:m}},{name:"rect",attrs:{x:r-u,y:p,width:u,height:1},styles:{color:m}},{name:"rect",attrs:{x:r,y:_,width:u,height:1},styles:{color:m}}],y.forEach((({attrs:e,styles:i})=>{var n;null===(n=this.createFigure("rect",e,i))||void 0===n||n.draw(t)}))}}class Ht extends Yt{getCandleBarOptions(t){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const i=t.getIndicatorStore().getInstances(e.getId());for(const e of i){const i=e[1];if(i.shouldOhlc){const e=i.styles,n=t.getStyles().indicator;return{type:"ohlc",styles:{upColor:x(e,"ohlc.upColor",n.ohlc.upColor),downColor:x(e,"ohlc.downColor",n.ohlc.downColor),noChangeColor:x(e,"ohlc.noChangeColor",n.ohlc.noChangeColor)}}}}}return null}drawImp(t){var e;super.drawImp(t);const i=this.getWidget(),n=i.getPane(),s=n.getChart(),o=i.getBounding(),r=null===(e=s.getPaneById(ct.XAXIS))||void 0===e?void 0:e.getAxisComponent(),a=n.getAxisComponent(),l=s.getChartStore(),c=l.getDataList(),h=l.getTimeScaleStore(),u=h.getVisibleRange(),d=l.getIndicatorStore().getInstances(n.getId()),g=l.getStyles().indicator;d.forEach((e=>{var i;let n=!1;if(null!==e.draw&&(t.save(),n=null!==(i=e.draw({ctx:t,kLineDataList:c,indicator:e,visibleRange:u,bounding:o,barSpace:h.getBarSpace(),defaultStyles:g,xAxis:r,yAxis:a}))&&void 0!==i&&i,t.restore()),!n){const i=e.result,n=[],s=[],o=[];this.eachChildren(((r,l)=>{var h;const{halfGapBar:d,gapBar:m}=l,{dataIndex:p,x:_}=r,x=null!==(h=i[p])&&void 0!==h?h:{};P(c,e,p,g,((e,i,r,l)=>{var c,h,g;const f=x[e.key],y=a.convertToPixel(f);switch(e.type){case"circle":v(f)&&(null===(c=this.createFigure("circle",{x:_,y:y,r:d},{style:i.style,color:i.color,borderColor:i.color}))||void 0===c||c.draw(t));break;case"bar":if(v(f)){const n=null!==(h=e.baseValue)&&void 0!==h?h:a.getExtremum().min,s=a.convertToPixel(n),o=Math.abs(s-y);let r;r=y>s?s:o<1?s-1:y,null===(g=this.createFigure("rect",{x:_-d,y:r,width:m,height:o},{style:i.style,color:i.color,borderColor:i.color}))||void 0===g||g.draw(t)}break;case"line":{let t=null;if(v(f)){t=i;const e={x:_,y:y},a=n[l];v(s[l])||(s[l]=[]),s[l].push(e),v(a)&&((null==a?void 0:a.color)!==i.color||(null==a?void 0:a.style)!==i.style)&&(o.push({name:"line",attrs:{coordinates:s[l]},styles:{style:i.style,color:i.color,size:r.size,smooth:r.smooth,dashedValue:r.dashedValue}}),s[l]=[e]),p===u.to-1&&o.push({name:"line",attrs:{coordinates:s[l]},styles:{style:i.style,color:null==i?void 0:i.color,size:r.size,smooth:r.smooth,dashedValue:r.dashedValue}})}n[l]=t;break}}}))})),o.forEach((({attrs:e,styles:i})=>{var n;null===(n=this.createFigure("line",e,i))||void 0===n||n.draw(t)}))}}))}}class Xt extends Ot{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=e.getBounding(),s=e.getPane().getChart().getChartStore(),o=s.getCrosshairStore().get(),r=s.getStyles().crosshair;if(void 0!==o.paneId&&r.show){if(o.paneId===i.getId()){const e=o.y;this._drawLine(t,[{x:0,y:e},{x:n.width,y:e}],r.horizontal)}const e=o.realX;this._drawLine(t,[{x:e,y:0},{x:e,y:n.height}],r.horizontal)}}_drawLine(t,e,i){var n;if(i.show){const s=i.line;s.show&&(null===(n=this.createFigure("line",{coordinates:e},s))||void 0===n||n.draw(t))}}}class $t extends Ot{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=i.getChart().getChartStore(),s=n.getCrosshairStore().get();if(void 0!==s.kLineData){const o=e.getBounding(),r=n.getCustomApi(),a=n.getIndicatorStore().getInstances(i.getId()),l=n.getStyles().indicator;this.drawIndicatorTooltip(t,n.getDataList(),s,a,r,o,l)}}drawIndicatorTooltip(t,e,i,n,s,o,a,l){const c=a.tooltip;let h=0;if(this.isDrawTooltip(i,c)){const u=c.text,d=u.marginLeft,g=u.marginRight,v=u.size,m=u.weight,p=u.family;let _=null!=l?l:0;t.font=r(v,m,p),n.forEach((n=>{var r;const{name:l,calcParamsText:x,values:f}=this.getIndicatorTooltipData(e,i,n,s,a),y=void 0!==l&&l.length>0,S=void 0!==f&&f.length>0;let C=0;if(y||S){if(_+=u.marginTop,h+=u.marginTop+v+u.marginBottom,y&&c.showName){C+=d;let e=l;void 0!==x&&x.length>0&&c.showParams&&(e=`${e}${x}`),null===(r=this.createFigure("text",{x:C,y:_,text:e},{color:u.color,size:v,family:p,weight:m}))||void 0===r||r.draw(t),C+=t.measureText(e).width+g}if(S){const e=this.drawStandardTooltip(t,o,f,C,_,u);h+=e,_+=e}_+=v+u.marginBottom}}))}return h}drawStandardTooltip(t,e,i,n,s,o){let a=n,l=s,c=0;const{marginLeft:h,marginTop:u,marginRight:d,marginBottom:g,size:v,family:m,weight:p}=o;return t.font=r(v,p,m),i.forEach(((i,n)=>{var s,o;const r=i.title,_=i.value,x=t.measureText(r.text).width,f=t.measureText(_.text).width;a+h+(x+f)+d>e.width?(a=h,c+=v+u+g,l+=v+u+g):a+=h,null===(s=this.createFigure("text",{x:a,y:l,text:r.text},{color:r.color,size:v,family:m,weight:p}))||void 0===s||s.draw(t),a+=x,null===(o=this.createFigure("text",{x:a,y:l,text:_.text},{color:_.color,size:v,family:m,weight:p}))||void 0===o||o.draw(t),a+=f+d})),c}isDrawTooltip(t,e){const i=e.showRule;return"always"===i||"follow_cross"===i&&void 0!==t.paneId}getIndicatorTooltipData(t,e,i,n,s){var o,r,a;if(null!==i.createTooltipDataSource){const n=this.getWidget(),r=n.getPane(),a=r.getChart().getChartStore(),l=i.createTooltipDataSource({kLineDataList:t,indicator:i,visibleRange:a.getTimeScaleStore().getVisibleRange(),bounding:n.getBounding(),crosshair:e,defaultStyles:s,xAxis:null===(o=r.getChart().getPaneById(ct.XAXIS))||void 0===o?void 0:o.getAxisComponent(),yAxis:r.getAxisComponent()});if(void 0!==l.values){const t=[],e=s.tooltip.text.color;l.values.forEach((i=>{let n={text:"",color:e};d(i.title)?n=i.title:n.text=i.title;let s={text:"",color:e};d(i.value)?s=i.value:s.text=i.value,t.push({title:n,value:s})})),l.values=t}return l}const l=e.dataIndex,c=null!==(r=i.result)&&void 0!==r?r:[];let h="";const u=i.calcParams;u.length>0&&(h=`(${u.join(",")})`);const g=null!==(a=c[l])&&void 0!==a?a:{},m=[];return P(t,i,l,s,((t,e)=>{if(void 0!==t.title){const o=e.color;let r=g[t.key];v(r)&&(r=y(r,i.precision),i.shouldFormatBigNumber&&(r=n.formatBigNumber(r))),m.push({title:{text:t.title,color:o},value:{text:null!=r?r:s.tooltip.defaultValue,color:o}})}})),{name:i.shortName,calcParamsText:h,values:m}}}class jt extends Ot{constructor(t){super(t),this._initEvent()}_initEvent(){const t=this.getWidget().getPane(),e=t.getId(),i=t.getChart().getChartStore().getOverlayStore();this.registerEvent("mouseMoveEvent",(t=>{var n;const s=i.getProgressInstanceInfo();if(null!==s){const o=s.instance;let r=s.paneId;return o.isStart()&&(i.updateProgressInstanceInfo(e),r=e),o.isDrawing()&&r===e&&(o.eventMoveForDrawing(this._coordinateToPoint(s.instance,t)),null===(n=o.onDrawing)||void 0===n||n.call(o,{overlay:o,...t})),this._figureMouseMoveEvent(s.instance,"point",s.instance.points.length-1,0)(t)}return i.setHoverInstanceInfo({paneId:e,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},t),!1})).registerEvent("mouseDownEvent",(t=>{var n,s;const o=i.getProgressInstanceInfo();if(null!==o){const r=o.instance;let a=o.paneId;return r.isStart()&&(i.updateProgressInstanceInfo(e,!0),a=e),r.isDrawing()&&a===e&&(r.eventMoveForDrawing(this._coordinateToPoint(r,t)),null===(n=r.onDrawing)||void 0===n||n.call(r,{overlay:r,...t}),r.nextStep(),r.isDrawing()||(i.progressInstanceComplete(),null===(s=r.onDrawEnd)||void 0===s||s.call(r,{overlay:r,...t}))),this._figureMouseDownEvent(r,"point",r.points.length-1,0)(t)}return i.setClickInstanceInfo({paneId:e,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},t),!1})).registerEvent("mouseRightClickEvent",(t=>{const e=i.getProgressInstanceInfo();if(null!==e){const i=e.instance;if(i.isDrawing())return this._figureMouseRightClickEvent(i,"point",i.points.length-1,0)(t)}return!1})).registerEvent("mouseUpEvent",(t=>{var n;const{instance:s}=i.getPressedInstanceInfo();return null!==s&&(null===(n=s.onPressedMoveEnd)||void 0===n||n.call(s,{overlay:s,...t})),i.setPressedInstanceInfo({paneId:e,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1}),!1})).registerEvent("pressedMouseMoveEvent",(t=>{var e,n;const{instance:s,figureType:o,figureIndex:r}=i.getPressedInstanceInfo();if(null!==s){if(!(s.lock||null!==(n=null===(e=s.onPressedMoving)||void 0===e?void 0:e.call(s,{overlay:s,...t}))&&void 0!==n&&n)){const e=this._coordinateToPoint(s,t);"point"===o?s.eventPressedPointMove(e,r):s.eventPressedOtherMove(e,this.getWidget().getPane().getChart().getChartStore().getTimeScaleStore())}return!0}return!1}))}_createFigureEvents(t,e,i,n){if(!t.isDrawing())return{mouseMoveEvent:this._figureMouseMoveEvent(t,e,i,n),mouseDownEvent:this._figureMouseDownEvent(t,e,i,n),mouseRightClickEvent:this._figureMouseRightClickEvent(t,e,i,n)}}_figureMouseMoveEvent(t,e,i,n){return s=>{const o=this.getWidget().getPane();return o.getChart().getChartStore().getOverlayStore().setHoverInstanceInfo({paneId:o.getId(),instance:t,figureType:e,figureIndex:i,attrsIndex:n},s),!0}}_figureMouseDownEvent(t,e,i,n){return s=>{var o;const r=this.getWidget().getPane(),a=r.getId(),l=r.getChart().getChartStore().getOverlayStore();return t.startPressedMove(this._coordinateToPoint(t,s)),null===(o=t.onPressedMoveStart)||void 0===o||o.call(t,{overlay:t,...s}),l.setPressedInstanceInfo({paneId:a,instance:t,figureType:e,figureIndex:i,attrsIndex:n}),l.setClickInstanceInfo({paneId:a,instance:t,figureType:e,figureIndex:i,attrsIndex:n},s),!0}}_figureMouseRightClickEvent(t,e,i,n){return e=>{var i,n;if(null===(n=null===(i=t.onRightClick)||void 0===i?void 0:i.call(t,{overlay:t,...e}))||void 0===n||!n){this.getWidget().getPane().getChart().getChartStore().getOverlayStore().removeInstance(t)}return!0}}_coordinateToPoint(t,e){var i,n;const s={},o=this.getWidget().getPane(),r=o.getChart(),a=o.getId(),l=r.getChartStore().getTimeScaleStore();if(this.coordinateToPointTimestampDataIndexFlag()){const t=(null===(i=r.getPaneById(ct.XAXIS))||void 0===i?void 0:i.getAxisComponent()).convertFromPixel(e.x),o=null!==(n=l.dataIndexToTimestamp(t))&&void 0!==n?n:void 0;s.dataIndex=t,s.timestamp=o}if(this.coordinateToPointValueFlag()){const i=o.getAxisComponent();let n=i.convertFromPixel(e.y);if("normal"!==t.mode&&a===ct.CANDLE&&void 0!==s.dataIndex){const e=l.getDataByDataIndex(s.dataIndex);if(null!==e)if(n>e.high)if("weak_magnet"===t.mode){const t=i.convertToPixel(e.high);n<i.convertFromPixel(t-8)&&(n=e.high)}else n=e.high;else if(n<e.low)if("weak_magnet"===t.mode){const t=i.convertToPixel(e.low);n>i.convertFromPixel(t-8)&&(n=e.low)}else n=e.low;else{const t=Math.max(e.open,e.close),i=Math.min(e.open,e.close);n=n>t?n-t<e.high-n?t:e.high:n<i?n-e.low<i-n?e.low:i:t-n<n-i?t:i}}s.value=n}return s}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,e,i){return this.getWidget().getPane().getChart().getChartStore().getOverlayStore().isDrawing()?this.onEvent(t,e,i):super.dispatchEvent(t,e,i)}checkEventOn(t){return!0}drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=n.getId(),o=n.getChart(),r=n.getAxisComponent(),a=null===(e=o.getPaneById(ct.XAXIS))||void 0===e?void 0:e.getAxisComponent(),l=i.getBounding(),c=o.getChartStore(),h=c.getCustomApi(),u=c.getTimeScaleStore(),d=u.getDateTimeFormat(),g=u.getBarSpace(),v=c.getPrecision(),m=c.getStyles().overlay,p=c.getOverlayStore(),_=p.getHoverInstanceInfo(),x=p.getClickInstanceInfo();this.getCompleteOverlays(p,s).forEach((e=>{this._drawOverlay(t,e,l,g,v,d,h,m,a,r,_,x,u)}));const f=p.getProgressInstanceInfo();if(null!==f){const e=this.getProgressOverlay(f,s);null!==e&&this._drawOverlay(t,e,l,g,v,d,h,m,a,r,_,x,u)}}_drawOverlay(t,e,i,n,s,o,r,a,l,c,h,u,d){const{points:g}=e,v=g.map((t=>{var e,i;let n=t.dataIndex;void 0!==t.timestamp&&(n=d.timestampToDataIndex(t.timestamp));const s={x:0,y:0};return void 0!==n&&(s.x=null!==(e=null==l?void 0:l.convertToPixel(n))&&void 0!==e?e:0),void 0!==t.value&&(s.y=null!==(i=null==c?void 0:c.convertToPixel(t.value))&&void 0!==i?i:0),s}));if(v.length>0){const r=(new Array).concat(this.getFigures(e,v,i,n,s,o,a,l,c));this.drawFigures(t,e,r,a)}this.drawDefaultFigures(t,e,v,i,s,o,r,a,l,c,h,u)}drawFigures(t,e,i,n){i.forEach(((i,s)=>{const{type:o,styles:r,attrs:a,ignoreEvent:l}=i;[].concat(a).forEach(((i,a)=>{var c,h;const u=null!=l&&l?void 0:this._createFigureEvents(e,"other",s,a),d={...n[o],...null===(c=e.styles)||void 0===c?void 0:c[o],...r};null===(h=this.createFigure(o,i,d,u))||void 0===h||h.draw(t)}))}))}getCompleteOverlays(t,e){return t.getInstances(e)}getProgressOverlay(t,e){return t.paneId===e?t.instance:null}getFigures(t,e,i,n,s,o,r,a,l){var c,h;return null!==(h=null===(c=t.createPointFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:r,xAxis:a,yAxis:l}))&&void 0!==h?h:[]}drawDefaultFigures(t,e,i,n,s,o,r,a,l,c,h,u){var d,g;if(e.needDefaultPointFigure&&((null===(d=h.instance)||void 0===d?void 0:d.id)===e.id&&"none"!==h.figureType||(null===(g=u.instance)||void 0===g?void 0:g.id)===e.id&&"none"!==u.figureType)){const n=e.styles,s={...a.point,...null==n?void 0:n.point};i.forEach((({x:i,y:n},o)=>{var r,a,l;let c=s.radius,u=s.color,d=s.borderColor,g=s.borderSize;(null===(r=h.instance)||void 0===r?void 0:r.id)===e.id&&"point"===h.figureType&&h.figureIndex===o&&(c=s.activeRadius,u=s.activeColor,d=s.activeBorderColor,g=s.activeBorderSize),null===(a=this.createFigure("circle",{x:i,y:n,r:c+g},{color:d},this._createFigureEvents(e,"point",o,0)))||void 0===a||a.draw(t),null===(l=this.createFigure("circle",{x:i,y:n,r:c},{color:u}))||void 0===l||l.draw(t)}))}}}class Gt extends yt{constructor(t,e){super(t,e),this._gridView=new zt(this),this._indicatorView=new Ht(this),this._crosshairLineView=new Xt(this),this._tooltipView=this.createTooltipView(),this._overlayView=new jt(this),this.addChild(this._overlayView),this.getContainer().style.cursor="crosshair"}getName(){return nt}updateMain(t){this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t)}createTooltipView(){return new $t(this)}updateMainContent(t){}updateOverlay(t){this._overlayView.draw(t),this._crosshairLineView.draw(t),this._tooltipView.draw(t)}}class Ut extends Wt{drawImp(t){var e,i;const n=this.getWidget(),s=n.getPane(),o=s.getChart(),r=s.getChart().getChartStore(),a=n.getBounding(),l=s.getAxisComponent(),c=r.getTimeScaleStore().getBarSpace(),u=o.getStyles().candle.area,d=[],v=[];let m=Number.MAX_SAFE_INTEGER;this.eachChildren(((t,e,i)=>{const{data:n,x:s}=t,{halfGapBar:o}=e,r=n[u.value];if(g(r)){const t=l.convertToPixel(r);if(0===i){const e=s-o;v.push({x:e,y:a.height}),v.push({x:e,y:t}),d.push({x:e,y:t})}d.push({x:s,y:t}),v.push({x:s,y:t}),m=Math.min(m,t)}}));const p=v.length;if(p>0){const t=v[p-1],e=t.x+c.halfGapBar;d.push({x:e,y:t.y}),v.push({x:e,y:t.y}),v.push({x:e,y:a.height})}if(d.length>0&&(null===(e=this.createFigure("line",{coordinates:d},{color:u.lineColor,size:u.lineSize}))||void 0===e||e.draw(t)),v.length>0){const e=u.backgroundColor;let n;if(h(e)){const i=t.createLinearGradient(0,a.height,0,m);try{e.forEach((({offset:t,color:e})=>{i.addColorStop(t,e)}))}catch(t){}n=i}else n=e;null===(i=this.createFigure("polygon",{coordinates:v},{color:n}))||void 0===i||i.draw(t)}}}class Zt extends Wt{drawImp(t){const e=this.getWidget().getPane(),i=e.getChart().getChartStore(),n=i.getStyles().candle.priceMark,s=n.high,o=n.low;if(n.show&&(s.show||o.show)){const n=i.getPrecision(),r=e.getAxisComponent();let a=Number.MIN_SAFE_INTEGER,l=0,c=Number.MAX_SAFE_INTEGER,h=0;this.eachChildren(((t,e,i)=>{const{data:n,x:s}=t;a<n.high&&(a=n.high,l=s),c>n.low&&(c=n.low,h=s)}));const u=r.convertToPixel(a),d=r.convertToPixel(c);s.show&&a!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,y(a,n.price),{x:l,y:u},u<d?[-2,-5]:[2,5],s),o.show&&c!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,y(c,n.price),{x:h,y:d},u<d?[2,5]:[-2,-5],o)}}_drawMark(t,e,i,n,s){var o,r,a;const l=i.x,c=i.y+n[0];let h,u,d;null===(o=this.createFigure("line",{coordinates:[{x:l-2,y:c+n[0]},{x:l,y:c},{x:l+2,y:c+n[0]}]},{color:s.color}))||void 0===o||o.draw(t);const{width:g}=this.getWidget().getBounding();l>g/2?(h=l-5,u=h-s.textOffset,d="right"):(h=l+5,d="left",u=h+s.textOffset);const v=c+n[1];null===(r=this.createFigure("line",{coordinates:[{x:l,y:c},{x:l,y:v},{x:h,y:v}]},{color:s.color}))||void 0===r||r.draw(t),null===(a=this.createFigure("text",{x:u,y:v,text:e,align:d,baseline:"middle"},{color:s.color,size:s.textSize,family:s.textFamily,weight:s.textWeight}))||void 0===a||a.draw(t)}}class qt extends Ot{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getChart().getChartStore(),r=o.getStyles().candle.priceMark,a=r.last,l=a.line;if(r.show&&a.show&&l.show){const i=n.getAxisComponent(),r=o.getDataList(),c=r[r.length-1];if(null!=c){const{close:n,open:o}=c,r=i.convertToNicePixel(n);let h;h=n>o?a.upColor:n<o?a.downColor:a.noChangeColor,null===(e=this.createFigure("line",{coordinates:[{x:0,y:r},{x:s.width,y:r}]},{style:l.style,color:h,size:l.size,dashedValue:l.dashedValue}))||void 0===e||e.draw(t)}}}}const Kt={"zh-CN":{time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量："},"en-US":{time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: "}};function Jt(t,e){var i,n;return null!==(n=null===(i=Kt[e])||void 0===i?void 0:i[t])&&void 0!==n?n:t}class Qt extends $t{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=n.getChart().getChartStore(),o=s.getCrosshairStore().get();if(void 0!==o.kLineData){const r=i.getBounding(),a=null===(e=n.getYAxisWidget())||void 0===e?void 0:e.getBounding(),l=s.getDataList(),c=s.getPrecision(),h=s.getLocale(),u=s.getCustomApi(),d=s.getIndicatorStore().getInstances(n.getId()),g=s.getTimeScaleStore().getDateTimeFormat(),v=s.getStyles(),m=v.candle,p=v.indicator;if("rect"===m.tooltip.showType&&"rect"===p.tooltip.showType){const e=this.isDrawTooltip(o,m.tooltip),i=this.isDrawTooltip(o,p.tooltip);this._drawRectTooltip(t,l,d,r,a,o,c,g,h,u,e,i,v,0)}else if("standard"===m.tooltip.showType&&"standard"===p.tooltip.showType){const e=this._drawCandleStandardTooltip(t,r,o,c,g,h,u,m);this.drawIndicatorTooltip(t,l,o,d,u,r,p,e)}else if("rect"===m.tooltip.showType&&"standard"===p.tooltip.showType){const e=this.drawIndicatorTooltip(t,l,o,d,u,r,p,0),i=this.isDrawTooltip(o,m.tooltip);this._drawRectTooltip(t,l,d,r,a,o,c,g,h,u,i,!1,v,e)}else{const e=this._drawCandleStandardTooltip(t,r,o,c,g,h,u,m),i=this.isDrawTooltip(o,p.tooltip);this._drawRectTooltip(t,l,d,r,a,o,c,g,h,u,!1,i,v,e)}}}_drawCandleStandardTooltip(t,e,i,n,s,o,r,a){const l=a.tooltip,c=l.text;let h=0;if(this.isDrawTooltip(i,l)){const l=this._getCandleTooltipData(i.kLineData,n,s,o,r,a);l.length>0&&(h+=c.marginTop+c.size+c.marginBottom,h+=this.drawStandardTooltip(t,e,l,0,c.marginTop,c))}return h}_drawRectTooltip(t,e,i,n,s,o,a,l,c,h,u,d,g,v){var m,p;const _=g.candle,x=g.indicator,f=_.tooltip,y=x.tooltip;if(u||d){const S=this._getCandleTooltipData(o.kLineData,a,l,c,h,_),{marginLeft:C,marginRight:b,marginTop:w,marginBottom:E,size:I,weight:T,family:D}=f.text,{paddingLeft:M,paddingRight:P,paddingTop:k,paddingBottom:A,offsetLeft:F,offsetRight:L,offsetTop:B,borderSize:R,borderRadius:N,borderColor:V,color:O}=f.rect;let z=0,W=0,Y=0;u&&(t.font=r(I,T,D),S.forEach((e=>{const i=e.title,n=e.value,s=`${i.text}${n.text}`,o=t.measureText(s).width+C+b;z=Math.max(z,o)})),Y+=(E+w+I)*S.length);const{marginLeft:H,marginRight:X,marginTop:$,marginBottom:j,size:G,weight:U,family:Z}=y.text,q=[];if(d&&(t.font=r(G,U,Z),i.forEach((i=>{var n;const s=null!==(n=this.getIndicatorTooltipData(e,o,i,h,x).values)&&void 0!==n?n:[];q.push(s),s.forEach((e=>{const i=e.title,n=e.value,s=`${i.text}${n.text}`,o=t.measureText(s).width+H+X;z=Math.max(z,o),Y+=$+j+G}))}))),W+=z,0!==W&&0!==Y){W+=2*R+M+P,Y+=2*R+k+A;const e=n.width/2;let i;(null!==(m=o.realX)&&void 0!==m?m:0)<e?(i=n.width-L-W,g.yAxis.inside&&"right"===g.yAxis.position&&(i-=s.width)):(i=F,g.yAxis.inside&&"left"===g.yAxis.position&&(i+=s.width));const r=v+B;null===(p=this.createFigure("rect",{x:i,y:r,width:W,height:Y},{style:"stroke_fill",color:O,borderColor:V,borderSize:R,borderRadius:N}))||void 0===p||p.draw(t);const a=i+R+M+C;let l=r+R+k;if(u&&S.forEach((e=>{var n,s;l+=w;const o=e.title;null===(n=this.createFigure("text",{x:a,y:l,text:o.text},{color:o.color,size:I,family:D,weight:T}))||void 0===n||n.draw(t);const r=e.value;null===(s=this.createFigure("text",{x:i+W-R-b-P,y:l,text:r.text,align:"right"},{color:r.color,size:I,family:D,weight:T}))||void 0===s||s.draw(t),l+=I+E})),d){const e=i+R+M+H;q.forEach((n=>{n.forEach((n=>{var s,o;l+=$;const r=n.title,a=n.value;null===(s=this.createFigure("text",{x:e,y:l,text:r.text},{color:r.color,size:G,family:Z,weight:U}))||void 0===s||s.draw(t),null===(o=this.createFigure("text",{x:i+W-R-X-P,y:l,text:a.text,align:"right"},{color:a.color,size:G,family:Z,weight:U}))||void 0===o||o.draw(t),l+=G+j}))}))}}}}_getCandleTooltipData(t,e,i,n,s,o){var r,a,l;const c=o.tooltip,h=c.text.color;let g=[];if(u(c.custom)){(null!==(a=null===(r=c.custom)||void 0===r?void 0:r.call(c,t,o))&&void 0!==a?a:[]).forEach((({title:t,value:e})=>{let i={text:"",color:""};d(t)?i=t:(i.text=t,i.color=h),i.text=Jt(i.text,n);let s={text:"",color:""};d(e)?s=e:(s.text=e,s.color=h),g.push({title:i,value:s})}))}else{const{price:o,volume:r}=e;g=[{title:{text:Jt("time",n),color:h},value:{text:s.formatDate(i,t.timestamp,"YYYY-MM-DD HH:mm",0),color:h}},{title:{text:Jt("open",n),color:h},value:{text:y(t.open,o),color:h}},{title:{text:Jt("high",n),color:h},value:{text:y(t.high,o),color:h}},{title:{text:Jt("low",n),color:h},value:{text:y(t.low,o),color:h}},{title:{text:Jt("close",n),color:h},value:{text:y(t.close,o),color:h}},{title:{text:Jt("volume",n),color:h},value:{text:s.formatBigNumber(y(null!==(l=t.volume)&&void 0!==l?l:c.defaultValue,r)),color:h}}]}return g}}class te extends Gt{constructor(){super(...arguments),this._candleBarView=new Yt(this),this._candleAreaView=new Ut(this),this._candleHighLowPriceView=new Zt(this),this._candleLastPriceLineView=new qt(this)}updateMainContent(t){"area"!==this.getPane().getChart().getStyles().candle.type?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleLastPriceLineView.draw(t)):this._candleAreaView.draw(t)}createTooltipView(){return new Qt(this)}}class ee extends Ot{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getAxisComponent(),r=this.getAxisStyles(n.getChart().getStyles());if(r.show){r.axisLine.show&&(null===(e=this.createFigure("line",this.createAxisLine(s,r),r.axisLine))||void 0===e||e.draw(t));const i=o.getTicks();if(r.tickLine.show){this.createTickLines(i,s,r).forEach((e=>{var i;null===(i=this.createFigure("line",e,r.tickLine))||void 0===i||i.draw(t)}))}if(r.tickText.show){this.createTickTexts(i,s,r).forEach((e=>{var i;null===(i=this.createFigure("text",e,r.tickText))||void 0===i||i.draw(t)}))}}}}class ie extends ee{getAxisStyles(t){return t.yAxis}createAxisLine(t,e){const i=this.getWidget().getPane().getAxisComponent(),n=e.axisLine.size;let s;return s=i.isFromZero()?n/2:t.width-n,{coordinates:[{x:s,y:0},{x:s,y:t.height}]}}createTickLines(t,e,i){const n=this.getWidget().getPane().getAxisComponent(),s=i.axisLine,o=i.tickLine;let r=0,a=0;return n.isFromZero()?(r=0,s.show&&(r+=s.size),a=r+o.length):(r=e.width,s.show&&(r-=s.size),a=r-o.length),t.map((t=>({coordinates:[{x:r,y:t.coord},{x:a,y:t.coord}]})))}createTickTexts(t,e,i){const n=this.getWidget().getPane().getAxisComponent(),s=i.axisLine,o=i.tickLine,r=i.tickText;let a=0;n.isFromZero()?(a=r.marginStart,s.show&&(a+=s.size),o.show&&(a+=o.length)):(a=e.width-r.marginEnd,s.show&&(a-=s.size),o.show&&(a-=o.length));const l=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map((t=>({x:a,y:t.coord,text:t.text,align:l,baseline:"middle"})))}}class ne extends Ot{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getChart().getChartStore(),r=o.getStyles().candle.priceMark,a=r.last,l=a.text;if(r.show&&a.show&&l.show){const i=o.getPrecision(),r=n.getAxisComponent(),c=o.getDataList(),h=o.getVisibleDataList(),u=c[c.length-1];if(void 0!==u){const{close:n,open:o}=u,c=r.convertToNicePixel(n);let d,g,v,m;if(d=n>o?a.upColor:n<o?a.downColor:a.noChangeColor,"percentage"===r.getType()){const t=h[0].data.close;g=`${((n-t)/t*100).toFixed(2)}%`}else g=y(n,i.price);r.isFromZero()?(v=0,m="left"):(v=s.width,m="right"),null===(e=this.createFigure("rectText",{x:v,y:c,text:g,align:m,baseline:"middle"},{...l,backgroundColor:d}))||void 0===e||e.draw(t)}}}}class se extends Ot{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=e.getBounding(),s=i.getChart().getChartStore(),o=s.getCustomApi(),r=s.getStyles().indicator,a=r.lastValueMark,l=a.text;if(a.show){const e=i.getAxisComponent(),a=s.getDataList(),c=a.length-1;s.getIndicatorStore().getInstances(i.getId()).forEach((i=>{const s=i.result[c];if(void 0!==s){const h=i.precision;P(a,i,c,r,((r,a)=>{var c;const u=s[r.key];if(v(u)){const s=e.convertToNicePixel(u);let r,d,g=y(u,h);i.shouldFormatBigNumber&&(g=o.formatBigNumber(g)),e.isFromZero()?(r=0,d="left"):(r=n.width,d="right"),null===(c=this.createFigure("rectText",{x:r,y:s,text:g,align:d,baseline:"middle"},{...l,backgroundColor:a.color}))||void 0===c||c.draw(t)}}))}}))}}}class oe extends jt{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(t,e,i,n,s,o,r,a,l,c,h,u){this.drawFigures(t,e,this.getDefaultFigures(e,i,n,s,o,r,l,c,u),a)}getDefaultFigures(t,e,i,n,s,o,r,a,l){var c,h;const u=[];if(t.needDefaultYAxisFigure&&t.id===(null===(c=l.instance)||void 0===c?void 0:c.id)&&l.paneId===this.getWidget().getPane().getId()){let s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;let r,l;null!==(h=null==a?void 0:a.isFromZero())&&void 0!==h&&h?(r="left",l=0):(r="right",l=i.width),e.forEach(((e,i)=>{const a=t.points[i];if(void 0!==a.value){s=Math.min(s,e.y),o=Math.max(o,e.y);const t=y(a.value,n.price);u.push({type:"rectText",attrs:{x:l,y:e.y,text:t,align:r,baseline:"middle"},ignoreEvent:!0})}})),e.length>1&&u.unshift({type:"rect",attrs:{x:0,y:s,width:i.width,height:o-s},ignoreEvent:!0})}return u}getFigures(t,e,i,n,s,o,r,a,l){var c,h;return null!==(h=null===(c=t.createYAxisFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:r,xAxis:a,yAxis:l}))&&void 0!==h?h:[]}}class re extends Ot{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=i.getPane().getChart().getChartStore(),a=o.getCrosshairStore().get(),l=o.getStyles().crosshair;if(void 0!==a.paneId&&void 0!==a.kLineData&&this.checkPaneId(a,n.getId())&&l.show){const i=this.getDirectionStyles(l),c=i.text;if(i.show&&c.show){const i=n.getAxisComponent(),l=this.getText(a,o,i);t.font=r(c.size,c.weight,c.family),null===(e=this.createFigure("rectText",this.getTextAttrs(l,t.measureText(l).width,a,s,i,c),c))||void 0===e||e.draw(t)}}}checkPaneId(t,e){return t.paneId===e}getDirectionStyles(t){return t.horizontal}getText(t,e,i){var n,s;const o=i,r=i.convertFromPixel(t.y);let a;if("percentage"===o.getType()){const t=null!==(s=null===(n=e.getVisibleDataList()[0])||void 0===n?void 0:n.data)&&void 0!==s?s:{};a=`${((r-t.close)/t.close*100).toFixed(2)}%`}else{const i=e.getIndicatorStore().getInstances(t.paneId);let n=0,s=!1;o.isInCandle()?n=e.getPrecision().price:i.forEach((t=>{n=Math.max(t.precision,n),s||(s=t.shouldFormatBigNumber)})),a=y(r,n),s&&(a=e.getCustomApi().formatBigNumber(a))}return a}getTextAttrs(t,e,i,n,s,o){let r,a;return s.isFromZero()?(r=0,a="left"):(r=n.width,a="right"),{x:r,y:i.y,text:t,align:a,baseline:"middle"}}}class ae extends yt{constructor(t,e){super(t,e),this._yAxisView=new ie(this),this._candleLastPriceLabelView=new ne(this),this._indicatorLastValueView=new se(this),this._overlayYAxisView=new oe(this),this._crosshairHorizontalLabelView=new re(this),this.getContainer().style.cursor="ns-resize",this.addChild(this._overlayYAxisView)}getName(){return ot}updateMain(t){this._yAxisView.draw(t),this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)}updateOverlay(t){this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t)}}class le{constructor(t){this._extremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._prevExtremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._ticks=[],this._autoCalcTickFlag=!0,this._parent=t}getParent(){return this._parent}buildTicks(t){return this._autoCalcTickFlag&&(this._extremum=this.calcExtremum()),!(this._prevExtremum.min===this._extremum.min&&this._prevExtremum.max===this._extremum.max&&!t)&&(this._prevExtremum=this._extremum,this._ticks=this.optimalTicks(this._calcTicks()),!0)}getTicks(){return this._ticks}setExtremum(t){this._autoCalcTickFlag=!1,this._extremum=t}getExtremum(){return this._extremum}setAutoCalcTickFlag(t){this._autoCalcTickFlag=t}getAutoCalcTickFlag(){return this._autoCalcTickFlag}_calcTicks(){const{realMin:t,realMax:e,realRange:i}=this._extremum,n=[];if(i>=0){const[s,o]=this._calcTickInterval(i),r=b(Math.ceil(t/s)*s,o),a=b(Math.floor(e/s)*s,o);let l=0,c=r;if(0!==s)for(;c<=a;){const t=c.toFixed(o);n[l]={text:t,coord:0,value:t},++l,c+=s}}return n}_calcTickInterval(t){const e=function(t){const e=Math.floor(E(t)),i=I(e),n=t/i;let s=0;return s=n<1.5?1:n<2.5?2:n<3.5?3:n<4.5?4:n<5.5?5:n<6.5?6:8,t=s*i,e>=-20?+t.toFixed(e<0?-e:0):t}(t/8);return[e,function(t){const e=t.toString(),i=e.indexOf("e");if(i>0){const t=+e.slice(i+1);return t<0?-t:0}{const t=e.indexOf(".");return t<0?0:e.length-1-t}}(e)]}}class ce extends le{calcExtremum(){var t,e,i,n,s;const o=this.getParent(),r=o.getChart(),a=r.getChartStore();let l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;const h=[];let u=!1,d=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,m=Number.MAX_SAFE_INTEGER;a.getIndicatorStore().getInstances(o.getId()).forEach((t=>{var e,i,n;u||(u=null!==(e=t.shouldOhlc)&&void 0!==e&&e),m=Math.min(m,t.precision),null!==t.minValue&&(d=Math.min(d,t.minValue)),null!==t.maxValue&&(g=Math.max(g,t.maxValue)),h.push({figures:null!==(i=t.figures)&&void 0!==i?i:[],result:null!==(n=t.result)&&void 0!==n?n:[]})}));let p=4;const _=this.isInCandle();if(_){const{price:t}=a.getPrecision();p=m!==Number.MAX_SAFE_INTEGER?Math.min(m,t):t}else m!==Number.MAX_SAFE_INTEGER&&(p=m);const x=a.getVisibleDataList(),f=r.getStyles().candle,y="area"===f.type,S=f.area.value,C=_&&!y||!_&&u;x.forEach((({dataIndex:t,data:e})=>{C&&(l=Math.min(l,e.low),c=Math.max(c,e.high)),_&&y&&(l=Math.min(l,e[S]),c=Math.max(c,e[S])),h.forEach((({figures:e,result:i})=>{var n;const s=null!==(n=i[t])&&void 0!==n?n:{};e.forEach((t=>{const e=s[t.key];v(e)&&(l=Math.min(l,e),c=Math.max(c,e))}))}))})),l!==Number.MAX_SAFE_INTEGER&&c!==Number.MIN_SAFE_INTEGER?(l=Math.min(d,l),c=Math.max(g,c)):(l=0,c=10);const b=this.getType();let w;switch(b){case"percentage":{const e=null===(t=x[0])||void 0===t?void 0:t.data;void 0!==(null==e?void 0:e.close)&&(l=(l-e.close)/e.close*100,c=(c-e.close)/e.close*100),w=Math.pow(10,-2);break}case"log":l=E(l),c=E(c),w=.05*I(-p);break;default:w=I(-p)}if(l===c||Math.abs(l-c)<w){const t=d===l,e=g===c;l=t?l:e?l-8*w:l-4*w,c=e?c:t?c+8*w:c+4*w}const T=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{gap:D}=o.getOptions();let M=null!==(n=null==D?void 0:D.top)&&void 0!==n?n:.2;M>=1&&(M/=T);let P=null!==(s=null==D?void 0:D.bottom)&&void 0!==s?s:.1;P>=1&&(P/=T);let k,A,F,L=Math.abs(c-l);return l-=L*P,c+=L*M,L=Math.abs(c-l),"log"===b?(k=I(l),A=I(c),F=Math.abs(A-k)):(k=l,A=c,F=L),{min:l,max:c,range:L,realMin:k,realMax:A,realRange:F}}_innerConvertToPixel(t){var e,i;const n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{min:s,range:o}=this.getExtremum(),r=(t-s)/o;return this.isReverse()?Math.round(r*n):Math.round((1-r)*n)}isInCandle(){return"candle"===this.getParent().getName()}getType(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.type:"normal"}getPosition(){return this.getParent().getChart().getStyles().yAxis.position}isReverse(){return!!this.isInCandle()&&this.getParent().getChart().getStyles().yAxis.reverse}isFromZero(){const t=this.getParent().getChart().getStyles().yAxis,e=t.inside;return"left"===t.position&&e||"right"===t.position&&!e}optimalTicks(t){var e,i;const n=this.getParent(),s=null!==(i=null===(e=n.getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,o=n.getChart().getChartStore(),r=o.getCustomApi(),a=[],l=this.getType(),c=o.getIndicatorStore().getInstances(n.getId());let h=0,u=!1;this.isInCandle()?h=o.getPrecision().price:c.forEach((t=>{h=Math.max(h,t.precision),u||(u=t.shouldFormatBigNumber)}));const d=o.getStyles().xAxis.tickText.size;let g;return t.forEach((({value:t})=>{let e,i=this._innerConvertToPixel(+t);switch(l){case"percentage":e=`${y(t,2)}%`;break;case"log":i=this._innerConvertToPixel(E(+t)),e=y(t,h);break;default:e=y(t,h),u&&(e=r.formatBigNumber(t))}i>d&&i<s-d&&(void 0!==g&&Math.abs(g-i)>2*d||void 0===g)&&(a.push({text:e,coord:i,value:t}),g=i)})),a}getAutoSize(){const t=this.getParent(),e=t.getChart(),i=e.getStyles(),n=i.yAxis,s=n.size;if("auto"!==s)return s;const o=e.getChartStore(),r=o.getCustomApi();let l=0;if(n.show&&(n.axisLine.show&&(l+=n.axisLine.size),n.tickLine.show&&(l+=n.tickLine.length),n.tickText.show)){let t=0;this.getTicks().forEach((e=>{t=Math.max(t,a(e.text,n.tickText.size,n.tickText.weight,n.tickText.family))})),l+=n.tickText.marginStart+n.tickText.marginEnd+t}const c=i.crosshair;let h=0;if(c.show&&c.horizontal.show&&c.horizontal.text.show){const e=o.getIndicatorStore().getInstances(t.getId());let n=0,s=!1;e.forEach((t=>{n=Math.max(t.precision,n),s||(s=t.shouldFormatBigNumber)}));let l=2;if("percentage"!==this.getType())if(this.isInCandle()){const{price:t}=o.getPrecision(),e=i.indicator.lastValueMark;l=e.show&&e.text.show?Math.max(n,t):t}else l=n;let u=y(this.getExtremum().max,l);s&&(u=r.formatBigNumber(u)),h+=c.horizontal.text.paddingLeft+c.horizontal.text.paddingRight+2*c.horizontal.text.borderSize+a(u,c.horizontal.text.size,c.horizontal.text.weight,c.horizontal.text.family)}return Math.max(l,h)}convertFromPixel(t){var e,i,n;const s=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{min:o,range:r}=this.getExtremum(),a=(this.isReverse()?t/s:1-t/s)*r+o;switch(this.getType()){case"percentage":{const t=null===(n=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===n?void 0:n.data;return void 0!==(null==t?void 0:t.close)?t.close*a/100+t.close:0}case"log":return I(a);default:return a}}convertToRealValue(t){let e=t;return"log"===this.getType()&&(e=I(t)),e}convertToPixel(t){var e;let i=t;switch(this.getType()){case"percentage":{const n=null===(e=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===e?void 0:e.data;void 0!==(null==n?void 0:n.close)&&(i=(t-n.close)/n.close*100);break}case"log":i=E(t);break;default:i=t}return this._innerConvertToPixel(i)}convertToNicePixel(t){var e,i;const n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,s=this.convertToPixel(t);return Math.round(Math.max(.05*n,Math.min(s,.98*n)))}}class he extends ht{getName(){return"indicator"}createAxisComponent(){return new ce(this)}createMainWidget(t){return new Gt(t,this)}createSeparatorWidget(t){return new lt(t,this)}creatYAxisWidget(t){return new ae(t,this)}}class ue extends he{getName(){return"candle"}createMainWidget(t){return new te(t,this)}createSeparatorWidget(t){return null}}class de extends ee{getAxisStyles(t){return t.xAxis}createAxisLine(t,e){const i=e.axisLine.size/2;return{coordinates:[{x:0,y:i},{x:t.width,y:i}]}}createTickLines(t,e,i){const n=i.tickLine,s=i.axisLine.size;return t.map((t=>({coordinates:[{x:t.coord,y:0},{x:t.coord,y:s+n.length}]})))}createTickTexts(t,e,i){const n=i.tickText,s=i.axisLine.size,o=i.tickLine.length;return t.map((t=>({x:t.coord,y:s+o+n.marginStart,text:t.text,align:"center",baseline:"top"})))}}class ge extends oe{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(t){return t.getInstances()}getProgressOverlay(t){return t.instance}getDefaultFigures(t,e,i,n,s,o,r,a,l){var c;const h=[];if(t.needDefaultXAxisFigure&&t.id===(null===(c=l.instance)||void 0===c?void 0:c.id)){let n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;e.forEach(((e,i)=>{n=Math.min(n,e.x),r=Math.max(r,e.x);const a=t.points[i];if(void 0!==a.timestamp){const t=o.formatDate(s,a.timestamp,"YYYY-MM-DD HH:mm",1);h.push({type:"rectText",attrs:{x:e.x,y:0,text:t,align:"center"},ignoreEvent:!0})}})),e.length>1&&h.unshift({type:"rect",attrs:{x:n,y:0,width:r-n,height:i.height},ignoreEvent:!0})}return h}getFigures(t,e,i,n,s,o,r,a,l){var c,h;return null!==(h=null===(c=t.createXAxisFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:r,xAxis:a,yAxis:l}))&&void 0!==h?h:[]}}class ve extends re{checkPaneId(t){return t.dataIndex===t.realDataIndex}getDirectionStyles(t){return t.vertical}getText(t,e,i){var n;const s=null===(n=t.kLineData)||void 0===n?void 0:n.timestamp;return e.getCustomApi().formatDate(e.getTimeScaleStore().getDateTimeFormat(),s,"YYYY-MM-DD HH:mm",1)}getTextAttrs(t,e,i,n,s,o){const r=i.realX;let a;return a=r-e/2-o.paddingLeft<0?o.paddingLeft+e/2:r+e/2+o.paddingRight>n.width?n.width-o.paddingRight-e/2:r,{x:a,y:0,text:t,align:"center",baseline:"top"}}}class me extends yt{constructor(t,e){super(t,e),this._xAxisView=new de(this),this._overlayXAxisView=new ge(this),this._crosshairVerticalLabelView=new ve(this),this.getContainer().style.cursor="ew-resize",this.addChild(this._overlayXAxisView)}getName(){return st}updateMain(t){this._xAxisView.draw(t)}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}class pe extends le{calcExtremum(){const t=this.getParent().getChart().getChartStore(),{from:e,to:i}=t.getTimeScaleStore().getVisibleRange(),n=i-1,s=i-e;return{min:e,max:n,range:s,realMin:e,realMax:n,realRange:s}}optimalTicks(t){var e,i;const n=this.getParent().getChart(),s=n.getChartStore(),o=s.getCustomApi().formatDate,r=[],l=t.length,c=s.getDataList();if(l>0){const h=s.getTimeScaleStore().getDateTimeFormat(),u=n.getStyles().xAxis.tickText,d=a("00-00 00:00",u.size,u.weight,u.family),g=parseInt(t[0].value,10),v=this.convertToPixel(g);let m=1;if(l>1){const e=parseInt(t[1].value,10),i=this.convertToPixel(e),n=Math.abs(i-v);n<d&&(m=Math.ceil(d/n))}for(let i=0;i<l;i+=m){const n=parseInt(t[i].value,10),s=c[n].timestamp;let a=o(h,s,"HH:mm",2);if(0!==i){const n=c[parseInt(t[i-m].value,10)].timestamp;a=null!==(e=this._optimalTickLabel(o,h,s,n))&&void 0!==e?e:a}const l=this.convertToPixel(n);r.push({text:a,coord:l,value:s})}if(1===r.length)r[0].text=o(h,r[0].value,"YYYY-MM-DD HH:mm",2);else{const t=r[0].value,e=r[1].value;if(void 0!==r[2]){const e=r[2].text;/^[0-9]{2}-[0-9]{2}$/.test(e)?r[0].text=o(h,t,"MM-DD",2):/^[0-9]{4}-[0-9]{2}$/.test(e)?r[0].text=o(h,t,"YYYY-MM",2):/^[0-9]{4}$/.test(e)&&(r[0].text=o(h,t,"YYYY",2))}else r[0].text=null!==(i=this._optimalTickLabel(o,h,t,e))&&void 0!==i?i:r[0].text}}return r}_optimalTickLabel(t,e,i,n){const s=t(e,i,"YYYY",2),o=t(e,i,"YYYY-MM",2),r=t(e,i,"MM-DD",2);return s!==t(e,n,"YYYY",2)?s:o!==t(e,n,"YYYY-MM",2)?o:r!==t(e,n,"MM-DD",2)?r:null}getAutoSize(){const t=this.getParent().getChart().getStyles(),e=t.xAxis,i=e.size;if("auto"!==i)return i;const n=t.crosshair;let s=0;e.show&&(e.axisLine.show&&(s+=e.axisLine.size),e.tickLine.show&&(s+=e.tickLine.length),e.tickText.show&&(s+=e.tickText.marginStart+e.tickText.marginEnd+e.tickText.size));let o=0;return n.show&&n.vertical.show&&n.vertical.text.show&&(o+=n.vertical.text.paddingTop+n.vertical.text.paddingBottom+2*n.vertical.text.borderSize+n.vertical.text.size),Math.max(s,o)}convertFromPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().dataIndexToCoordinate(t)}}class _e extends ht{getName(){return"xAxis"}createAxisComponent(){return new pe(this)}createMainWidget(t){return new me(t,this)}}function xe(){var t;return"undefined"!=typeof window&&(null!==(t=window.navigator.userAgent.toLowerCase().indexOf("firefox"))&&void 0!==t?t:-1)>-1}function fe(){return"undefined"!=typeof window&&/iPhone|iPad|iPod/.test(window.navigator.platform)}class ye{constructor(t,e,i){this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!fe(),this._onFirefoxOutsideMouseUp=t=>{this._mouseUpHandler(t)},this._onMobileSafariDoubleClick=t=>{if(this._firesTouchEvents(t)){if(++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:e}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);e<30&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(t),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:e}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);e<5&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}},this._target=t,this._handler=e,this._options=i,this._init()}destroy(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeMouseWheel&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),null!==this._unsubscribeContextMenu&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(t){var e,i,n;null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this);const s=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",s)},this._target.addEventListener("mousemove",s);const o=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",o)},this._target.addEventListener("wheel",o,{passive:!1});const r=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",r)},this._target.addEventListener("contextmenu",r,{passive:!1}),this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(t){this._mousePressed||null!==this._touchMoveStartCoordinate||this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(void 0===this._handler.mouseWheelHortEvent)return;if(this._preventDefault(t),0===Math.abs(t.deltaX))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(t),-t.deltaX)}else{if(void 0===this._handler.mouseWheelVertEvent)return;let e=-t.deltaY/100;if(0===e)return;switch(this._preventDefault(t),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){const i=Math.sign(e)*Math.min(1,Math.abs(e));this._handler.mouseWheelVertEvent(this._makeCompatEvent(t),i)}}}_contextMenuHandler(t){this._preventDefault(t)}_touchMoveHandler(t){const e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null===e)return;if(this._lastTouchEventTimeStamp=this._eventTimeStamp(t),null!==this._startPinchMiddleCoordinate)return;if(this._preventTouchDragProcess)return;this._pinchPrevented=!0;const i=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._touchMoveStartCoordinate),{xOffset:n,yOffset:s,manhattanDistance:o}=i;if(this._touchMoveExceededManhattanDistance||!(o<5)){if(!this._touchMoveExceededManhattanDistance){const t=.5*n,e=s>=t&&!this._options.treatVertDragAsPageScroll(),i=t>s&&!this._options.treatHorzDragAsPageScroll();e||i||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(t,e),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(t){if(0!==t.button)return;const e=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._mouseMoveStartCoordinate),{manhattanDistance:i}=e;i>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(t,e){const i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return{xOffset:i,yOffset:n,manhattanDistance:i+n}}_touchEndHandler(t){let e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null===e&&0===t.touches.length&&(e=t.changedTouches[0]),null===e)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const i=this._makeCompatEvent(t,e);if(this._processEvent(i,this._handler.touchEndEvent),++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);t<30&&!this._cancelTap&&this._processEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(i,this._handler.tapEvent),void 0!==this._handler.tapEvent&&this._preventDefault(t));0===this._tapCount&&this._preventDefault(t),0===t.touches.length&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(t))}_mouseUpHandler(t){if(0!==t.button)return;const e=this._makeCompatEvent(t);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),xe()){this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}if(!this._firesTouchEvents(t))if(this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);i<5&&!this._cancelClick&&this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent)}_clearLongTapTimeout(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(t){if(null!==this._activeTouchId)return;const e=t.changedTouches[0];this._activeTouchId=e.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(t);const i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(e),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const e=this._touchMoveHandler.bind(this),n=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",e),i.removeEventListener("touchend",n)},i.addEventListener("touchmove",e,{passive:!1}),i.addEventListener("touchend",n,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),240)}this._processEvent(this._makeCompatEvent(t,e),this._handler.touchStartEvent),null===this._tapTimeoutId&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=this._getCoordinate(e))}_mouseDownHandler(t){if(2===t.button)return this._preventDefault(t),void this._processEvent(this._makeCompatEvent(t),this._handler.mouseRightClickEvent);if(0!==t.button)return;const e=this._target.ownerDocument.documentElement;xe()&&e.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(t),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const t=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i)},e.addEventListener("mousemove",t),e.addEventListener("mouseup",i)}this._mousePressed=!0,this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseDownEvent),null===this._clickTimeoutId&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=this._getCoordinate(t)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const t=this._target.ownerDocument,e=t=>{null!=this._handler.mouseDownOutsideEvent&&(t.composed&&this._target.contains(t.composedPath()[0])||null!==t.target&&this._target.contains(t.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{t.removeEventListener("touchstart",e)},this._unsubscribeOutsideMouseEvents=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}fe()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),"undefined"!=typeof window&&void 0!==window.chrome&&(this._target.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1})),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(()=>{}),{passive:!1}))}_initPinch(){void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(t=>this._checkPinchState(t.touches)),{passive:!0}),this._target.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this._startPinchMiddleCoordinate&&void 0!==this._handler.pinchEvent){const e=this._getTouchDistance(t.touches[0],t.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},e),this._preventDefault(t)}}),{passive:!1}),this._target.addEventListener("touchend",(t=>{this._checkPinchState(t.touches)})))}_checkPinchState(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}_startPinch(t){var e;const i=null!==(e=this._target.getBoundingClientRect())&&void 0!==e?e:{left:0,top:0};this._startPinchMiddleCoordinate={x:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,y:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this._startPinchDistance=this._getTouchDistance(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(t){var e,i,n;null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this),this._firesTouchEvents(t)||this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!fe())}_longTapHandler(t){const e=this._touchWithId(t.touches,this._activeTouchId);null!==e&&(this._processEvent(this._makeCompatEvent(t,e),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(t){var e;return void 0!==(null===(e=t.sourceCapabilities)||void 0===e?void 0:e.firesTouchEvents)?t.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(t)<this._lastTouchEventTimeStamp+500}_processEvent(t,e){null==e||e.call(this._handler,t)}_makeCompatEvent(t,e){var i;const n=null!=e?e:t,s=null!==(i=this._target.getBoundingClientRect())&&void 0!==i?i:{left:0,top:0};return{x:n.clientX-s.left,y:n.clientY-s.top,pageX:n.pageX,pageY:n.pageY,isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,preventDefault:()=>{"touchstart"!==t.type&&this._preventDefault(t)}}}_getTouchDistance(t,e){const i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}_preventDefault(t){t.cancelable&&t.preventDefault()}_getCoordinate(t){return{x:t.pageX,y:t.pageY}}_eventTimeStamp(t){var e;return null!==(e=t.timeStamp)&&void 0!==e?e:performance.now()}_touchWithId(t,e){for(let i=0;i<t.length;++i)if(t[i].identifier===e)return t[i];return null}}class Se{constructor(t,e){this._flingStartTime=(new Date).getTime(),this._flingScrollTimerId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=t=>{if(t.shiftKey)switch(t.code){case"Equal":this._chart.getChartStore().getTimeScaleStore().zoom(.5);break;case"Minus":this._chart.getChartStore().getTimeScaleStore().zoom(-.5);break;case"ArrowLeft":{const t=this._chart.getChartStore().getTimeScaleStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chart.getChartStore().getTimeScaleStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}},this._container=t,this._chart=e,this._event=new ye(t,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),t.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(t,e){const{pane:i,widget:n}=this._findWidgetByEvent(t);if((null==i?void 0:i.getId())!==ct.XAXIS&&(null==n?void 0:n.getName())===nt){const i=this._makeWidgetEvent(t,n),s=5*(e-this._pinchScale);return this._pinchScale=e,this._chart.getChartStore().getTimeScaleStore().zoom(s,{x:i.x,y:i.y}),!0}return!1}mouseWheelHortEvent(t,e){const i=this._chart.getChartStore().getTimeScaleStore();return i.startScroll(),i.scroll(e),!0}mouseWheelVertEvent(t,e){var i,n;const{widget:s}=this._findWidgetByEvent(t),o=null!==(i=t.isTouch)&&void 0!==i&&i,r=this._makeWidgetEvent(t,s);let a=null;const l=null==s?void 0:s.getName();if(o)if(l===nt||l===st)a={x:r.x,y:r.y};else{const t=null===(n=this._chart.getPaneById(ct.CANDLE))||void 0===n?void 0:n.getBounding();a={x:t.width/2,y:t.height/2}}else l===nt&&(a={x:r.x,y:r.y});return null!==a&&(this._chart.getChartStore().getTimeScaleStore().zoom(e,{x:r.x,y:r.y}),!0)}mouseDownEvent(t){var e,i;const{pane:n,widget:s}=this._findWidgetByEvent(t);if(this._mouseDownWidget=s,null!==s){const o=this._makeWidgetEvent(t,s);switch(s.getName()){case rt:return s.dispatchEvent("mouseDownEvent",o);case nt:{const t=null!==(e=null==n?void 0:n.getAxisComponent().getExtremum())&&void 0!==e?e:null;return this._prevYAxisExtremum=null===t?t:{...t},this._startScrollCoordinate={x:o.x,y:o.y},this._chart.getChartStore().getTimeScaleStore().startScroll(),s.dispatchEvent("mouseDownEvent",o)}case st:{const t=s.dispatchEvent("mouseDownEvent",o);return t&&this._chart.updatePane(1),this._xAxisStartScaleCoordinate={x:o.x,y:o.y},this._xAxisStartScaleDistance=o.pageX,t}case ot:{const t=s.dispatchEvent("mouseDownEvent",o);t&&this._chart.updatePane(1);const e=null!==(i=null==n?void 0:n.getAxisComponent().getExtremum())&&void 0!==i?i:null;return this._prevYAxisExtremum=null===e?e:{...e},this._yAxisStartScaleDistance=o.pageY,t}}}return!1}mouseMoveEvent(t){var e,i,n;const{pane:s,widget:o}=this._findWidgetByEvent(t),r=this._makeWidgetEvent(t,o);if((null===(e=this._mouseMoveTriggerWidgetInfo.pane)||void 0===e?void 0:e.getId())===(null==s?void 0:s.getId())&&(null===(i=this._mouseMoveTriggerWidgetInfo.widget)||void 0===i?void 0:i.getName())===(null==o?void 0:o.getName())||(null==o||o.dispatchEvent("mouseEnterEvent",r),null===(n=this._mouseMoveTriggerWidgetInfo.widget)||void 0===n||n.dispatchEvent("mouseLeaveEvent",r),this._mouseMoveTriggerWidgetInfo={pane:s,widget:o}),null!==o){switch(o.getName()){case nt:return this._chart.getChartStore().getCrosshairStore().set({x:r.x,y:r.y,paneId:null==s?void 0:s.getId()}),o.dispatchEvent("mouseMoveEvent",r);case rt:case st:case ot:{const t=o.dispatchEvent("mouseMoveEvent",r);return this._chart.getChartStore().getCrosshairStore().set(),t}}}return!1}pressedMouseMoveEvent(t){var e,i,n,s;if(null!==this._mouseDownWidget&&this._mouseDownWidget.getName()===rt)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",t);const{pane:o,widget:r}=this._findWidgetByEvent(t);if(null!==r&&(null===(e=this._mouseDownWidget)||void 0===e?void 0:e.getPane().getId())===(null==o?void 0:o.getId())&&(null===(i=this._mouseDownWidget)||void 0===i?void 0:i.getName())===r.getName()){const e=this._makeWidgetEvent(t,r);switch(r.getName()){case nt:{const t=r.getBounding(),i=r.dispatchEvent("pressedMouseMoveEvent",e);if(!i&&null!==this._startScrollCoordinate){const i=null==o?void 0:o.getAxisComponent();if(null!==this._prevYAxisExtremum&&!i.getAutoCalcTickFlag()){const{min:s,max:o,range:r}=this._prevYAxisExtremum;let a;a=null!==(n=null==i?void 0:i.isReverse())&&void 0!==n&&n?this._startScrollCoordinate.y-e.y:e.y-this._startScrollCoordinate.y;const l=r*(a/t.height),c=s+l,h=o+l,u=i.convertToRealValue(c),d=i.convertToRealValue(h);i.setExtremum({min:c,max:h,range:h-c,realMin:u,realMax:d,realRange:d-u})}const s=e.x-this._startScrollCoordinate.x;this._chart.getChartStore().getTimeScaleStore().scroll(s)}return this._chart.getChartStore().getCrosshairStore().set({x:e.x,y:e.y,paneId:null==o?void 0:o.getId()}),i}case st:{const t=r.dispatchEvent("pressedMouseMoveEvent",e);if(t)this._chart.updatePane(1);else{const t=this._xAxisStartScaleDistance/e.pageX,i=10*(t-this._xAxisScale);this._xAxisScale=t,this._chart.getChartStore().getTimeScaleStore().zoom(i,null!==(s=this._xAxisStartScaleCoordinate)&&void 0!==s?s:void 0)}return t}case ot:{const t=r.dispatchEvent("pressedMouseMoveEvent",e);if(t)this._chart.updatePane(1);else if(null!==this._prevYAxisExtremum){const{min:t,max:i,range:n}=this._prevYAxisExtremum,s=n*(e.pageY/this._yAxisStartScaleDistance),r=(s-n)/2,a=t-r,l=i+r,c=null==o?void 0:o.getAxisComponent(),h=c.convertToRealValue(a),u=c.convertToRealValue(l);c.setExtremum({min:a,max:l,range:s,realMin:h,realMax:u,realRange:u-h}),this._chart.adjustPaneViewport(!1,!0,!0,!0)}return t}}}return!1}mouseUpEvent(t){const{widget:e}=this._findWidgetByEvent(t);let i=!1;if(null!==e){const n=this._makeWidgetEvent(t,e);switch(e.getName()){case nt:case rt:case st:case ot:i=e.dispatchEvent("mouseUpEvent",n)}i&&this._chart.updatePane(1)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,i}mouseRightClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);let i=!1;if(null!==e){const n=this._makeWidgetEvent(t,e);switch(e.getName()){case nt:case st:case ot:i=e.dispatchEvent("mouseRightClickEvent",n)}i&&this._chart.updatePane(1)}return!1}mouseDoubleClickEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&i.getName()===ot){const t=null==e?void 0:e.getAxisComponent();if(!t.getAutoCalcTickFlag())return t.setAutoCalcTickFlag(!0),this._chart.adjustPaneViewport(!1,!0,!0,!0),!0}return!1}mouseLeaveEvent(){return this._chart.getChartStore().getCrosshairStore().set(),!0}touchStartEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i){const n=this._makeWidgetEvent(t,i);switch(i.getName()){case nt:{const t=this._chart.getChartStore(),s=t.getCrosshairStore();if(i.dispatchEvent("mouseDownEvent",n))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,s.set(void 0,!0),this._chart.updatePane(1),!0;if(null!==this._flingScrollTimerId&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null),this._flingStartTime=(new Date).getTime(),this._startScrollCoordinate={x:n.x,y:n.y},t.getTimeScaleStore().startScroll(),this._touchZoomed=!1,null!==this._touchCoordinate){const t=n.x-this._touchCoordinate.x,i=n.y-this._touchCoordinate.y;Math.sqrt(t*t+i*i)<10?(this._touchCoordinate={x:n.x,y:n.y},s.set({x:n.x,y:n.y,paneId:null==e?void 0:e.getId()})):(this._touchCancelCrosshair=!0,this._touchCoordinate=null,s.set())}else this._touchCancelCrosshair=!1;return!0}case st:case ot:{const t=i.dispatchEvent("mouseDownEvent",n);return t&&this._chart.updatePane(1),t}}}return!1}touchMoveEvent(t){var e,i,n;const{pane:s,widget:o}=this._findWidgetByEvent(t);if(null!==o){const r=this._makeWidgetEvent(t,o);switch(o.getName()){case nt:{if(o.dispatchEvent("pressedMouseMoveEvent",r))return null===(e=r.preventDefault)||void 0===e||e.call(r),this._chart.updatePane(1),!0;const t=this._chart.getChartStore();if(null!==this._touchCoordinate)null===(i=r.preventDefault)||void 0===i||i.call(r),t.getCrosshairStore().set({x:r.x,y:r.y,paneId:null==s?void 0:s.getId()});else if(null!==this._startScrollCoordinate&&Math.abs(this._startScrollCoordinate.x-r.x)>this._startScrollCoordinate.y-r.y){const e=r.x-this._startScrollCoordinate.x;t.getTimeScaleStore().scroll(e)}return!0}case st:case ot:{const t=o.dispatchEvent("pressedMouseMoveEvent",r);return t&&(null===(n=r.preventDefault)||void 0===n||n.call(r),this._chart.updatePane(1)),t}}}return!1}touchEndEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(null!==e){const i=this._makeWidgetEvent(t,e);switch(e.getName()){case nt:if(e.dispatchEvent("mouseUpEvent",i),null!==this._startScrollCoordinate){const t=(new Date).getTime()-this._flingStartTime;let e=(i.x-this._startScrollCoordinate.x)/(t>0?t:1)*20;if(t<200&&Math.abs(e)>0){const t=this._chart.getChartStore().getTimeScaleStore(),i=()=>{this._flingScrollTimerId=setTimeout((()=>{t.startScroll(),t.scroll(e),e*=.975,Math.abs(e)<1?null!==this._flingScrollTimerId&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null):i()}),20)};i()}}return!0;case st:case ot:e.dispatchEvent("mouseUpEvent",i)&&this._chart.updatePane(1)}}return!1}tapEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&i.getName()===nt&&null===this._touchCoordinate&&!this._touchCancelCrosshair&&!this._touchZoomed){const n=this._makeWidgetEvent(t,i);return this._touchCoordinate={x:n.x,y:n.y},this._chart.getChartStore().getCrosshairStore().set({x:n.x,y:n.y,paneId:null==e?void 0:e.getId()}),!0}return!1}longTapEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&i.getName()===nt){const n=this._makeWidgetEvent(t,i);return this._touchCoordinate={x:n.x,y:n.y},this._chart.getChartStore().getCrosshairStore().set({x:n.x,y:n.y,paneId:null==e?void 0:e.getId()}),!0}return!1}_findWidgetByEvent(t){const e=this._chart.getAllPanes(),{x:i,y:n}=t;let s=null;for(const[,t]of e){const e=t.getBounding();if(i>=e.left&&i<=e.left+e.width&&n>=e.top&&n<=e.top+e.height){s=t;break}}null===s&&(s=this._chart.getPaneById(ct.XAXIS));let o=null;if(null!==s){const t=s.getSeparatorWidget();if(null!==t){const e=t.getBounding();i>=e.left&&i<=e.left+e.width&&n>=e.top&&n<=e.top+7&&(o=t)}if(null===o){const t=s.getMainWidget(),e=t.getBounding();i>=e.left&&i<=e.left+e.width&&n>=e.top&&n<=e.top+e.height&&(o=t)}if(null===o){const t=s.getYAxisWidget();if(null!==t){const e=t.getBounding();i>=e.left&&i<=e.left+e.width&&n>=e.top&&n<=e.top+e.height&&(o=t)}}}return{pane:s,widget:o}}_makeWidgetEvent(t,e){var i,n,s;const o=null!==(i=null==e?void 0:e.getBounding())&&void 0!==i?i:null;return{...t,x:t.x-(null!==(n=null==o?void 0:o.left)&&void 0!==n?n:0),y:t.y-(null!==(s=null==o?void 0:o.top)&&void 0!==s?s:0)}}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()}}class Ce{constructor(t,e){this._panes=new Map,this._initContainer(t),this._chartEvent=new Se(this._chartContainer,this),this._chartStore=new pt(this,e),this._xAxisPane=new _e(this._chartContainer,this,ct.XAXIS),this._panes.set(ct.CANDLE,new ue(this._chartContainer,this,ct.CANDLE)),this.adjustPaneViewport(!0,!0,!0)}_initContainer(t){this._container=t,this._chartContainer=n("div",{position:"relative",width:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}_measurePaneHeight(){var t;const e=this._container.offsetHeight,i=this._xAxisPane.getAxisComponent().getAutoSize();let n=e-i;n<0&&(n=0);let s=0;this._panes.forEach((t=>{if(t.getId()!==ct.CANDLE){let e=t.getBounding().height;const i=t.getOptions().minHeight;e<i&&(e=i),s+e>n?(s=n,e=Math.max(n-s,0)):s+=e,t.setBounding({height:e})}}));const o=n-s;null===(t=this._panes.get(ct.CANDLE))||void 0===t||t.setBounding({height:o});let r=0;this._panes.forEach((t=>{t.setBounding({top:r}),r+=t.getBounding().height})),this._xAxisPane.setBounding({height:i,top:r})}_measurePaneWidth(){const t=this._chartStore.getStyles().yAxis,e="left"===t.position,i=!t.inside,n=this._container.offsetWidth;let s=0,o=Number.MIN_SAFE_INTEGER,r=0,a=0;this._panes.forEach((t=>{o=Math.max(o,t.getAxisComponent().getAutoSize())})),o>n&&(o=n),i?(s=n-o,e?(r=0,a=o):(r=n-o,a=0)):(s=n,a=0,r=e?0:n-o),this._chartStore.getTimeScaleStore().setTotalBarSpace(s);const l={width:n},c={width:s,left:a},h={width:o,left:r};this._panes.forEach((t=>{t.setBounding(l,c,h)})),this._xAxisPane.setBounding(l,c,h)}_setPaneOptions(t,e){var i,n;const s=this._panes.get(null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"");let o=!1;if(void 0!==s){let i=e;if(t.id!==ct.CANDLE&&void 0!==t.height&&t.height>0){const e=Math.max(null!==(n=t.minHeight)&&void 0!==n?n:s.getOptions().minHeight,0),r=Math.max(e,t.height);s.setBounding({height:r}),i=!0,o=!0}s.setOptions(t),i&&this.adjustPaneViewport(o,!0,!0,!0,!0)}}getContainer(){return this._container}getChartStore(){return this._chartStore}getAllPanes(){return this._panes}adjustPaneViewport(t,e,i,n,s){t&&this._measurePaneHeight();let o=e;const r=null!=s&&s;(null!=n&&n||r)&&this._panes.forEach((t=>{const e=t.getAxisComponent().buildTicks(r);o||(o=e)})),o&&this._measurePaneWidth(),null!=i&&i&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4))}updatePane(t,e){var i;void 0!==e?null===(i=this.getPaneById(e))||void 0===i||i.update(t):(this._xAxisPane.update(t),this._panes.forEach((e=>{e.update(t)})))}getPaneById(t){var e;return t===ct.XAXIS?this._xAxisPane:null!==(e=this._panes.get(t))&&void 0!==e?e:null}crosshairChange(t){const e=this._chartStore.getActionStore();if(e.has("onCrosshairChange")){const i={};this._panes.forEach(((e,n)=>{const s={};this._chartStore.getIndicatorStore().getInstances(n).forEach((e=>{var i;const n=e.result;s[e.name]=n[null!==(i=t.dataIndex)&&void 0!==i?i:n.length-1]})),i[n]=s})),void 0!==t.paneId&&e.execute("onCrosshairChange",{...t,indicatorData:i})}}getDom(t,e){var i,n;if(void 0===t)return this._chartContainer;{const s=this.getPaneById(t);if(null!==s){switch(null!=e?e:"root"){case"root":return s.getContainer();case"main":return s.getMainWidget().getContainer();case"yAxis":return null!==(n=null===(i=s.getYAxisWidget())||void 0===i?void 0:i.getContainer())&&void 0!==n?n:null}}}return null}getSize(t,e){var i,n;if(void 0===t)return{width:this._chartContainer.offsetWidth,height:this._chartContainer.offsetHeight,left:0,top:0,right:0,bottom:0};{const s=this.getPaneById(t);if(null!==s){switch(null!=e?e:"root"){case"root":return s.getBounding();case"main":return s.getMainWidget().getBounding();case"yAxis":return null!==(n=null===(i=s.getYAxisWidget())||void 0===i?void 0:i.getBounding())&&void 0!==n?n:null}}}return null}setStyles(t){var e,i;let n;this._chartStore.setOptions({styles:t}),n=m(t)?mt(t):t,void 0!==(null===(e=null==n?void 0:n.yAxis)||void 0===e?void 0:e.type)&&(null===(i=this.getPaneById(ct.CANDLE))||void 0===i||i.getAxisComponent().setAutoCalcTickFlag(!0)),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getStyles(){return this._chartStore.getStyles()}setLocale(t){this._chartStore.setOptions({locale:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getLocale(){return this._chartStore.getLocale()}setCustomApi(t){this._chartStore.setOptions({customApi:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}setPriceVolumePrecision(t,e){this._chartStore.setPrecision({price:t,volume:e})}getPriceVolumePrecision(){return this._chartStore.getPrecision()}setTimezone(t){this._chartStore.setOptions({timezone:t}),this._xAxisPane.getAxisComponent().buildTicks(!0),this._xAxisPane.update(3)}getTimezone(){return this._chartStore.getTimeScaleStore().getTimezone()}setOffsetRightDistance(t){this._chartStore.getTimeScaleStore().setOffsetRightDistance(t,!0)}setLeftMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))}setRightMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))}setBarSpace(t){this._chartStore.getTimeScaleStore().setBarSpace(t)}getBarSpace(){return this._chartStore.getTimeScaleStore().getBarSpace().bar}getVisibleRange(){return this._chartStore.getTimeScaleStore().getVisibleRange()}clearData(){this._chartStore.clearDataList()}getDataList(){return this._chartStore.getDataList()}applyNewData(t,e){this._chartStore.clearDataList(),this.applyMoreData(t,e)}applyMoreData(t,e){this._chartStore.addData(t,0,e),this._chartStore.getIndicatorStore().calcInstance().then((t=>{(0===t.length||t.includes(!0))&&this.adjustPaneViewport(!1,!0,!0,!0)})).catch((t=>{}))}updateData(t){const e=this._chartStore.getDataList(),i=e.length,n=t.timestamp,s=x(e[i-1],"timestamp",0);if(n>=s){let e=i;n===s&&(e=i-1),this._chartStore.addData(t,e),this._chartStore.getIndicatorStore().calcInstance().then((t=>{(0===t.length||t.includes(!0))&&this.adjustPaneViewport(!1,!0,!0,!0)})).catch((t=>{}))}}loadMore(t){this._chartStore.getTimeScaleStore().setLoadMoreCallback(t)}createIndicator(t,e,n,s){var o,r;const a=m(t)?{name:t}:t;if(null===N(a.name))return null;let l;if(void 0!==(null==n?void 0:n.id)&&this._panes.has(n.id))l=n.id,this._chartStore.getIndicatorStore().addInstance(a,l,null!=e&&e).then((t=>{var e,i;this._setPaneOptions(n,null!==(i=null===(e=this._panes.get(l))||void 0===e?void 0:e.getAxisComponent().buildTicks(!0))&&void 0!==i&&i)})).catch((t=>{}));else{l=null!==(o=null==n?void 0:n.id)&&void 0!==o?o:i(ct.INDICATOR);const t=Array.from(this._panes.values()).pop(),c=new he(this._chartContainer,this,l,t);t.setBottomPane(c);const h=null!==(r=null==n?void 0:n.height)&&void 0!==r?r:100;c.setBounding({height:h}),null!=n&&c.setOptions(n),this._panes.set(l,c),this._chartStore.getIndicatorStore().addInstance(a,l,null!=e&&e).finally((()=>{this.adjustPaneViewport(!0,!0,!0,!0,!0),null==s||s()}))}return l}overrideIndicator(t,e,i){this._chartStore.getIndicatorStore().override(t,null!=e?e:null).then((t=>{t.length>0&&(this.adjustPaneViewport(!1,!0,!0,!0),null==i||i())})).catch((()=>{}))}getIndicatorByPaneId(t,e){return this._chartStore.getIndicatorStore().getInstanceByPaneId(t,e)}removeIndicator(t,e){const i=this._chartStore.getIndicatorStore();if(i.removeInstance(t,e)){let e=!1;if(t!==ct.CANDLE&&!i.hasInstances(t)){const i=this._panes.get(t);if(void 0!==i){e=!0;const n=i.getTopPane(),s=i.getBottomPane();null==s||s.setTopPane(n),null==n||n.setBottomPane(s),null==i||i.destroy(),this._panes.delete(t)}}this.adjustPaneViewport(e,!0,!0,!0,!0)}}createOverlay(t,e){const i=m(t)?{name:t}:t;if(null===tt(i.name))return null;let n=!0;void 0!==e&&null!==this.getPaneById(e)||(e=ct.CANDLE,n=!1);return this._chartStore.getOverlayStore().addInstance(i,e,n)}getOverlayById(t){return this._chartStore.getOverlayStore().getInstanceById(t)}overrideOverlay(t){this._chartStore.getOverlayStore().override(t)}removeOverlay(t){let e;void 0!==t&&(e=m(t)?{id:t}:t),this._chartStore.getOverlayStore().removeInstance(e)}setPaneOptions(t){this._setPaneOptions(t,!1)}setZoomEnabled(t){this._chartStore.getTimeScaleStore().setZoomEnabled(t)}isZoomEnabled(){return this._chartStore.getTimeScaleStore().getZoomEnabled()}setScrollEnabled(t){this._chartStore.getTimeScaleStore().setScrollEnabled(t)}isScrollEnabled(){return this._chartStore.getTimeScaleStore().getScrollEnabled()}scrollByDistance(t,e){const i=void 0===e||e<0?0:e,n=this._chartStore.getTimeScaleStore();if(i>0){n.startScroll();const e=(new Date).getTime(),s=()=>{const o=((new Date).getTime()-e)/i,r=o>=1,a=r?t:t*o;n.scroll(a),r||requestAnimationFrame(s)};s()}else n.startScroll(),n.scroll(t)}scrollToRealTime(t){const e=this._chartStore.getTimeScaleStore(),{bar:i}=e.getBarSpace(),n=(e.getOffsetRightBarCount()-e.getOffsetRightDistance()/i)*i;this.scrollByDistance(n,t)}scrollToDataIndex(t,e){const i=this._chartStore.getTimeScaleStore(),n=(i.getOffsetRightBarCount()+(this.getDataList().length-1-t))*i.getBarSpace().bar;this.scrollByDistance(n,e)}scrollToTimestamp(t,e){const i=C(this.getDataList(),"timestamp",t);this.scrollToDataIndex(i,e)}zoomAtCoordinate(t,e,i){const n=void 0===i||i<0?0:i,s=this._chartStore.getTimeScaleStore();if(n>0){const{bar:i}=s.getBarSpace(),o=i*t-i,r=(new Date).getTime(),a=()=>{const t=((new Date).getTime()-r)/n,l=t>=1,c=l?o:o*t;s.zoom(c/i,e),l||requestAnimationFrame(a)};a()}else s.zoom(t,e)}zoomAtDataIndex(t,e,i){const n=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:n,y:0},i)}zoomAtTimestamp(t,e,i){const n=C(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,n,i)}convertToPixel(t,e){var i;const{paneId:n=ct.CANDLE,absolute:s=!1}=e;let o=[];if(n!==ct.XAXIS){const e=this.getPaneById(n);if(null!==e){const i=this._chartStore.getTimeScaleStore(),n=e.getBounding(),r=(new Array).concat(t),a=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();o=r.map((t=>{const e={};let o=t.dataIndex;if(void 0!==t.timestamp&&(o=i.timestampToDataIndex(t.timestamp)),void 0!==o&&(e.x=null==a?void 0:a.convertToPixel(o)),void 0!==t.value){const i=null==l?void 0:l.convertToPixel(t.value);e.y=s?n.top+i:i}return e}))}}return h(t)?o:null!==(i=o[0])&&void 0!==i?i:{}}convertFromPixel(t,e){var i;const{paneId:n=ct.CANDLE,absolute:s=!1}=e;let o=[];if(n!==ct.XAXIS){const e=this.getPaneById(n);if(null!==e){const i=this._chartStore.getTimeScaleStore(),n=e.getBounding(),r=(new Array).concat(t),a=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();o=r.map((t=>{var e;const o={};if(void 0!==t.x){const n=a.convertFromPixel(t.x);o.dataIndex=n,o.timestamp=null!==(e=i.dataIndexToTimestamp(n))&&void 0!==e?e:void 0}if(void 0!==t.y){const e=s?t.y-n.top:t.y;o.value=l.convertFromPixel(e)}return o}))}}return h(t)?o:null!==(i=o[0])&&void 0!==i?i:{}}subscribeAction(t,e){this._chartStore.getActionStore().subscribe(t,e)}unsubscribeAction(t,e){this._chartStore.getActionStore().unsubscribe(t,e)}getConvertPictureUrl(t,e,i){const s=this._chartContainer.offsetWidth,r=this._chartContainer.offsetHeight,a=n("canvas",{width:`${s}px`,height:`${r}px`,boxSizing:"border-box"}),l=a.getContext("2d"),c=o(a);a.width=s*c,a.height=r*c,l.scale(c,c),l.fillStyle=null!=i?i:"#FFFFFF",l.fillRect(0,0,s,r);const h=null!=t&&t;this._panes.forEach((t=>{const e=t.getBounding();l.drawImage(t.getImage(h),0,e.top,s,e.height)}));const u=this._xAxisPane.getBounding();return l.drawImage(this._xAxisPane.getImage(h),0,u.top,s,u.height),a.toDataURL(`image/${null!=e?e:"jpeg"}`)}resize(){this.adjustPaneViewport(!0,!0,!0,!0,!0)}destroy(){this._chartEvent.destroy(),this._panes.forEach((t=>{t.destroy()})),this._panes.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer)}}const be={};let we=1;const Ee={clone:c,merge:l,isString:m,isNumber:g,isValid:v,isObject:d,isArray:h,isFunction:u,isBoolean:function(t){return"boolean"==typeof t},formatValue:x,formatPrecision:y,formatBigNumber:S,formatDate:f,getLinearSlopeIntercept:j,getLinearYFromSlopeIntercept:X,getLinearYFromCoordinates:$,checkCoordinateOnArc:function(t,e){if(Math.abs(function(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}(t,e)-e.r)<St){const{r:i,startAngle:n,endAngle:s}=e,o=i*Math.cos(n)+e.x,r=i*Math.sin(n)+e.y,a=i*Math.cos(s)+e.x,l=i*Math.sin(s)+e.y;return t.x<=Math.max(o,a)+St&&t.x>=Math.min(o,a)-St&&t.y<=Math.max(r,l)+St&&t.y>=Math.min(r,l)-St}return!1},checkCoordinateOnCircle:bt,checkCoordinateOnLine:H,checkCoordinateOnPolygon:It,checkCoordinateOnRect:Mt,checkCoordinateOnText:Ft,drawArc:function(t,e,i){const{x:n,y:s,r:o,startAngle:r,endAngle:a}=e,{style:l="solid",size:c=1,color:h="currentColor",dashedValue:u=[2,2]}=i;t.lineWidth=c,t.strokeStyle=h,"dashed"===l?t.setLineDash(u):t.setLineDash([]),t.beginPath(),t.arc(n,s,o,r,a),t.stroke(),t.closePath()},drawCircle:wt,drawLine:G,drawPolygon:Tt,drawRect:Pt,drawText:Lt,drawRectText:Rt};t.dispose=function(t){var e;let i;if(m(t)){const n=document.getElementById(t);i=null!==(e=null==n?void 0:n.getAttribute("chartId"))&&void 0!==e?e:null}else i=t instanceof Ce?t.id:null!=t?t:t.chartId;null!==i&&(be[i].destroy(),delete be[i])},t.getFigureClass=function(t){var e;return null!==(e=Vt[t])&&void 0!==e?e:null},t.getSupportedFigures=function(){return Object.keys(Vt)},t.getSupportedIndicators=function(){return Object.keys(B)},t.getSupportedLocales=function(){return Object.keys(Kt)},t.getSupportedOverlays=function(){return Object.keys(Q)},t.init=function(t,e){var i;let n;if(n=m(t)?document.getElementById(t):t,null===n)return null;let s=be[null!==(i=n.chartId)&&void 0!==i?i:""];if(void 0!==s)return s;const o="k_line_chart_"+we++;return s=new Ce(n,e),s.id=o,n.chartId=o,be[o]=s,s},t.registerFigure=function(t){Vt[t.name]=Ct.extend(t)},t.registerIndicator=function(t){B[t.name]=k.extend(t)},t.registerLocale=function(t,e){Kt[t]={...Kt[t],...e}},t.registerOverlay=function(t){Q[t.name]=z.extend(t)},t.registerStyles=function(t,e){vt[t]=e},t.utils=Ee,t.version=function(){return"9.0.0-alpha7"}}));
